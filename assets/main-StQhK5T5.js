var qn=Object.defineProperty;var Nn=(n,t,e)=>t in n?qn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var _=(n,t,e)=>Nn(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();function f(n,t,e,i){function s(o){return o instanceof e?o:new e(function(r){r(o)})}return new(e||(e=Promise))(function(o,r){function c(d){try{l(i.next(d))}catch(u){r(u)}}function a(d){try{l(i.throw(d))}catch(u){r(u)}}function l(d){d.done?o(d.value):s(d.value).then(c,a)}l((i=i.apply(n,[])).next())})}class E{constructor(t){this.client=t}static flatten(t,e=""){let i={};for(const[s,o]of Object.entries(t)){let r=e?e+"["+s+"]":s;Array.isArray(o)?i=Object.assign(Object.assign({},i),E.flatten(o,r)):i[r]=o}return i}}E.CHUNK_SIZE=5*1024*1024;class h extends Error{constructor(t,e=0,i="",s=""){super(t),this.name="AppwriteException",this.message=t,this.code=e,this.type=i,this.response=s}}class Vn{constructor(){this.config={endpoint:"https://cloud.appwrite.io/v1",endpointRealtime:"",project:"",jwt:"",locale:"",session:""},this.headers={"x-sdk-name":"Web","x-sdk-platform":"client","x-sdk-language":"web","x-sdk-version":"15.0.0","X-Appwrite-Response-Format":"1.5.0"},this.realtime={socket:void 0,timeout:void 0,url:"",channels:new Set,subscriptions:new Map,subscriptionsCounter:0,reconnect:!0,reconnectAttempts:0,lastMessage:void 0,connect:()=>{clearTimeout(this.realtime.timeout),this.realtime.timeout=window==null?void 0:window.setTimeout(()=>{this.realtime.createSocket()},50)},getTimeout:()=>{switch(!0){case this.realtime.reconnectAttempts<5:return 1e3;case this.realtime.reconnectAttempts<15:return 5e3;case this.realtime.reconnectAttempts<100:return 1e4;default:return 6e4}},createSocket:()=>{var t,e,i;if(this.realtime.channels.size<1){this.realtime.reconnect=!1,(t=this.realtime.socket)===null||t===void 0||t.close();return}const s=new URLSearchParams;s.set("project",this.config.project),this.realtime.channels.forEach(r=>{s.append("channels[]",r)});const o=this.config.endpointRealtime+"/realtime?"+s.toString();(o!==this.realtime.url||!this.realtime.socket||((e=this.realtime.socket)===null||e===void 0?void 0:e.readyState)>WebSocket.OPEN)&&(this.realtime.socket&&((i=this.realtime.socket)===null||i===void 0?void 0:i.readyState)<WebSocket.CLOSING&&(this.realtime.reconnect=!1,this.realtime.socket.close()),this.realtime.url=o,this.realtime.socket=new WebSocket(o),this.realtime.socket.addEventListener("message",this.realtime.onMessage),this.realtime.socket.addEventListener("open",r=>{this.realtime.reconnectAttempts=0}),this.realtime.socket.addEventListener("close",r=>{var c,a,l;if(!this.realtime.reconnect||((a=(c=this.realtime)===null||c===void 0?void 0:c.lastMessage)===null||a===void 0?void 0:a.type)==="error"&&((l=this.realtime)===null||l===void 0?void 0:l.lastMessage.data).code===1008){this.realtime.reconnect=!0;return}const d=this.realtime.getTimeout();console.error(`Realtime got disconnected. Reconnect will be attempted in ${d/1e3} seconds.`,r.reason),setTimeout(()=>{this.realtime.reconnectAttempts++,this.realtime.createSocket()},d)}))},onMessage:t=>{var e,i;try{const s=JSON.parse(t.data);switch(this.realtime.lastMessage=s,s.type){case"connected":const o=JSON.parse((e=window.localStorage.getItem("cookieFallback"))!==null&&e!==void 0?e:"{}"),r=o==null?void 0:o[`a_session_${this.config.project}`],c=s.data;r&&!c.user&&((i=this.realtime.socket)===null||i===void 0||i.send(JSON.stringify({type:"authentication",data:{session:r}})));break;case"event":let a=s.data;if(a!=null&&a.channels){if(!a.channels.some(d=>this.realtime.channels.has(d)))return;this.realtime.subscriptions.forEach(d=>{a.channels.some(u=>d.channels.includes(u))&&setTimeout(()=>d.callback(a))})}break;case"error":throw s.data;default:break}}catch(s){console.error(s)}},cleanUp:t=>{this.realtime.channels.forEach(e=>{t.includes(e)&&(Array.from(this.realtime.subscriptions).some(([s,o])=>o.channels.includes(e))||this.realtime.channels.delete(e))})}}}setEndpoint(t){return this.config.endpoint=t,this.config.endpointRealtime=this.config.endpointRealtime||this.config.endpoint.replace("https://","wss://").replace("http://","ws://"),this}setEndpointRealtime(t){return this.config.endpointRealtime=t,this}setProject(t){return this.headers["X-Appwrite-Project"]=t,this.config.project=t,this}setJWT(t){return this.headers["X-Appwrite-JWT"]=t,this.config.jwt=t,this}setLocale(t){return this.headers["X-Appwrite-Locale"]=t,this.config.locale=t,this}setSession(t){return this.headers["X-Appwrite-Session"]=t,this.config.session=t,this}subscribe(t,e){let i=typeof t=="string"?[t]:t;i.forEach(o=>this.realtime.channels.add(o));const s=this.realtime.subscriptionsCounter++;return this.realtime.subscriptions.set(s,{channels:i,callback:e}),this.realtime.connect(),()=>{this.realtime.subscriptions.delete(s),this.realtime.cleanUp(i),this.realtime.connect()}}call(t,e,i={},s={}){var o;return f(this,void 0,void 0,function*(){t=t.toUpperCase(),i=Object.assign({},this.headers,i);let r={method:t,headers:i,credentials:"include"};if(typeof window<"u"&&window.localStorage){const c=window.localStorage.getItem("cookieFallback");c&&(i["X-Fallback-Cookies"]=c)}if(t==="GET")for(const[c,a]of Object.entries(E.flatten(s)))e.searchParams.append(c,a);else switch(i["content-type"]){case"application/json":r.body=JSON.stringify(s);break;case"multipart/form-data":let c=new FormData;for(const a in s)Array.isArray(s[a])?s[a].forEach(l=>{c.append(a+"[]",l)}):c.append(a,s[a]);r.body=c,delete i["content-type"];break}try{let c=null;const a=yield fetch(e.toString(),r);if(!((o=a.headers.get("content-type"))===null||o===void 0)&&o.includes("application/json")?c=yield a.json():c={message:yield a.text()},400<=a.status)throw new h(c==null?void 0:c.message,a.status,c==null?void 0:c.type,c);const l=a.headers.get("X-Fallback-Cookies");return typeof window<"u"&&window.localStorage&&l&&(window.console.warn("Appwrite is using localStorage for session management. Increase your security by adding a custom domain as your API endpoint."),window.localStorage.setItem("cookieFallback",l)),c}catch(c){throw c instanceof h?c:new h(c.message)}})}}class zn extends E{constructor(t){super(t)}get(){return f(this,void 0,void 0,function*(){const t="/account",e={},i=new URL(this.client.config.endpoint+t);return yield this.client.call("get",i,{"content-type":"application/json"},e)})}create(t,e,i,s){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "userId"');if(typeof e>"u")throw new h('Missing required parameter: "email"');if(typeof i>"u")throw new h('Missing required parameter: "password"');const o="/account",r={};typeof t<"u"&&(r.userId=t),typeof e<"u"&&(r.email=e),typeof i<"u"&&(r.password=i),typeof s<"u"&&(r.name=s);const c=new URL(this.client.config.endpoint+o);return yield this.client.call("post",c,{"content-type":"application/json"},r)})}updateEmail(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "email"');if(typeof e>"u")throw new h('Missing required parameter: "password"');const i="/account/email",s={};typeof t<"u"&&(s.email=t),typeof e<"u"&&(s.password=e);const o=new URL(this.client.config.endpoint+i);return yield this.client.call("patch",o,{"content-type":"application/json"},s)})}listIdentities(t){return f(this,void 0,void 0,function*(){const e="/account/identities",i={};typeof t<"u"&&(i.queries=t);const s=new URL(this.client.config.endpoint+e);return yield this.client.call("get",s,{"content-type":"application/json"},i)})}deleteIdentity(t){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "identityId"');const e="/account/identities/{identityId}".replace("{identityId}",t),i={},s=new URL(this.client.config.endpoint+e);return yield this.client.call("delete",s,{"content-type":"application/json"},i)})}createJWT(){return f(this,void 0,void 0,function*(){const t="/account/jwt",e={},i=new URL(this.client.config.endpoint+t);return yield this.client.call("post",i,{"content-type":"application/json"},e)})}listLogs(t){return f(this,void 0,void 0,function*(){const e="/account/logs",i={};typeof t<"u"&&(i.queries=t);const s=new URL(this.client.config.endpoint+e);return yield this.client.call("get",s,{"content-type":"application/json"},i)})}updateMFA(t){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "mfa"');const e="/account/mfa",i={};typeof t<"u"&&(i.mfa=t);const s=new URL(this.client.config.endpoint+e);return yield this.client.call("patch",s,{"content-type":"application/json"},i)})}createMfaAuthenticator(t){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "type"');const e="/account/mfa/authenticators/{type}".replace("{type}",t),i={},s=new URL(this.client.config.endpoint+e);return yield this.client.call("post",s,{"content-type":"application/json"},i)})}updateMfaAuthenticator(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "type"');if(typeof e>"u")throw new h('Missing required parameter: "otp"');const i="/account/mfa/authenticators/{type}".replace("{type}",t),s={};typeof e<"u"&&(s.otp=e);const o=new URL(this.client.config.endpoint+i);return yield this.client.call("put",o,{"content-type":"application/json"},s)})}deleteMfaAuthenticator(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "type"');if(typeof e>"u")throw new h('Missing required parameter: "otp"');const i="/account/mfa/authenticators/{type}".replace("{type}",t),s={};typeof e<"u"&&(s.otp=e);const o=new URL(this.client.config.endpoint+i);return yield this.client.call("delete",o,{"content-type":"application/json"},s)})}createMfaChallenge(t){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "factor"');const e="/account/mfa/challenge",i={};typeof t<"u"&&(i.factor=t);const s=new URL(this.client.config.endpoint+e);return yield this.client.call("post",s,{"content-type":"application/json"},i)})}updateMfaChallenge(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "challengeId"');if(typeof e>"u")throw new h('Missing required parameter: "otp"');const i="/account/mfa/challenge",s={};typeof t<"u"&&(s.challengeId=t),typeof e<"u"&&(s.otp=e);const o=new URL(this.client.config.endpoint+i);return yield this.client.call("put",o,{"content-type":"application/json"},s)})}listMfaFactors(){return f(this,void 0,void 0,function*(){const t="/account/mfa/factors",e={},i=new URL(this.client.config.endpoint+t);return yield this.client.call("get",i,{"content-type":"application/json"},e)})}getMfaRecoveryCodes(){return f(this,void 0,void 0,function*(){const t="/account/mfa/recovery-codes",e={},i=new URL(this.client.config.endpoint+t);return yield this.client.call("get",i,{"content-type":"application/json"},e)})}createMfaRecoveryCodes(){return f(this,void 0,void 0,function*(){const t="/account/mfa/recovery-codes",e={},i=new URL(this.client.config.endpoint+t);return yield this.client.call("post",i,{"content-type":"application/json"},e)})}updateMfaRecoveryCodes(){return f(this,void 0,void 0,function*(){const t="/account/mfa/recovery-codes",e={},i=new URL(this.client.config.endpoint+t);return yield this.client.call("patch",i,{"content-type":"application/json"},e)})}updateName(t){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "name"');const e="/account/name",i={};typeof t<"u"&&(i.name=t);const s=new URL(this.client.config.endpoint+e);return yield this.client.call("patch",s,{"content-type":"application/json"},i)})}updatePassword(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "password"');const i="/account/password",s={};typeof t<"u"&&(s.password=t),typeof e<"u"&&(s.oldPassword=e);const o=new URL(this.client.config.endpoint+i);return yield this.client.call("patch",o,{"content-type":"application/json"},s)})}updatePhone(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "phone"');if(typeof e>"u")throw new h('Missing required parameter: "password"');const i="/account/phone",s={};typeof t<"u"&&(s.phone=t),typeof e<"u"&&(s.password=e);const o=new URL(this.client.config.endpoint+i);return yield this.client.call("patch",o,{"content-type":"application/json"},s)})}getPrefs(){return f(this,void 0,void 0,function*(){const t="/account/prefs",e={},i=new URL(this.client.config.endpoint+t);return yield this.client.call("get",i,{"content-type":"application/json"},e)})}updatePrefs(t){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "prefs"');const e="/account/prefs",i={};typeof t<"u"&&(i.prefs=t);const s=new URL(this.client.config.endpoint+e);return yield this.client.call("patch",s,{"content-type":"application/json"},i)})}createRecovery(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "email"');if(typeof e>"u")throw new h('Missing required parameter: "url"');const i="/account/recovery",s={};typeof t<"u"&&(s.email=t),typeof e<"u"&&(s.url=e);const o=new URL(this.client.config.endpoint+i);return yield this.client.call("post",o,{"content-type":"application/json"},s)})}updateRecovery(t,e,i){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "userId"');if(typeof e>"u")throw new h('Missing required parameter: "secret"');if(typeof i>"u")throw new h('Missing required parameter: "password"');const s="/account/recovery",o={};typeof t<"u"&&(o.userId=t),typeof e<"u"&&(o.secret=e),typeof i<"u"&&(o.password=i);const r=new URL(this.client.config.endpoint+s);return yield this.client.call("put",r,{"content-type":"application/json"},o)})}listSessions(){return f(this,void 0,void 0,function*(){const t="/account/sessions",e={},i=new URL(this.client.config.endpoint+t);return yield this.client.call("get",i,{"content-type":"application/json"},e)})}deleteSessions(){return f(this,void 0,void 0,function*(){const t="/account/sessions",e={},i=new URL(this.client.config.endpoint+t);return yield this.client.call("delete",i,{"content-type":"application/json"},e)})}createAnonymousSession(){return f(this,void 0,void 0,function*(){const t="/account/sessions/anonymous",e={},i=new URL(this.client.config.endpoint+t);return yield this.client.call("post",i,{"content-type":"application/json"},e)})}createEmailPasswordSession(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "email"');if(typeof e>"u")throw new h('Missing required parameter: "password"');const i="/account/sessions/email",s={};typeof t<"u"&&(s.email=t),typeof e<"u"&&(s.password=e);const o=new URL(this.client.config.endpoint+i);return yield this.client.call("post",o,{"content-type":"application/json"},s)})}updateMagicURLSession(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "userId"');if(typeof e>"u")throw new h('Missing required parameter: "secret"');const i="/account/sessions/magic-url",s={};typeof t<"u"&&(s.userId=t),typeof e<"u"&&(s.secret=e);const o=new URL(this.client.config.endpoint+i);return yield this.client.call("put",o,{"content-type":"application/json"},s)})}createOAuth2Session(t,e,i,s){if(typeof t>"u")throw new h('Missing required parameter: "provider"');const o="/account/sessions/oauth2/{provider}".replace("{provider}",t),r={};typeof e<"u"&&(r.success=e),typeof i<"u"&&(r.failure=i),typeof s<"u"&&(r.scopes=s);const c=new URL(this.client.config.endpoint+o);r.project=this.client.config.project;for(const[a,l]of Object.entries(E.flatten(r)))c.searchParams.append(a,l);if(typeof window<"u"&&(window!=null&&window.location))window.location.href=c.toString();else return c}updatePhoneSession(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "userId"');if(typeof e>"u")throw new h('Missing required parameter: "secret"');const i="/account/sessions/phone",s={};typeof t<"u"&&(s.userId=t),typeof e<"u"&&(s.secret=e);const o=new URL(this.client.config.endpoint+i);return yield this.client.call("put",o,{"content-type":"application/json"},s)})}createSession(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "userId"');if(typeof e>"u")throw new h('Missing required parameter: "secret"');const i="/account/sessions/token",s={};typeof t<"u"&&(s.userId=t),typeof e<"u"&&(s.secret=e);const o=new URL(this.client.config.endpoint+i);return yield this.client.call("post",o,{"content-type":"application/json"},s)})}getSession(t){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "sessionId"');const e="/account/sessions/{sessionId}".replace("{sessionId}",t),i={},s=new URL(this.client.config.endpoint+e);return yield this.client.call("get",s,{"content-type":"application/json"},i)})}updateSession(t){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "sessionId"');const e="/account/sessions/{sessionId}".replace("{sessionId}",t),i={},s=new URL(this.client.config.endpoint+e);return yield this.client.call("patch",s,{"content-type":"application/json"},i)})}deleteSession(t){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "sessionId"');const e="/account/sessions/{sessionId}".replace("{sessionId}",t),i={},s=new URL(this.client.config.endpoint+e);return yield this.client.call("delete",s,{"content-type":"application/json"},i)})}updateStatus(){return f(this,void 0,void 0,function*(){const t="/account/status",e={},i=new URL(this.client.config.endpoint+t);return yield this.client.call("patch",i,{"content-type":"application/json"},e)})}createPushTarget(t,e,i){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "targetId"');if(typeof e>"u")throw new h('Missing required parameter: "identifier"');const s="/account/targets/push",o={};typeof t<"u"&&(o.targetId=t),typeof e<"u"&&(o.identifier=e),typeof i<"u"&&(o.providerId=i);const r=new URL(this.client.config.endpoint+s);return yield this.client.call("post",r,{"content-type":"application/json"},o)})}updatePushTarget(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "targetId"');if(typeof e>"u")throw new h('Missing required parameter: "identifier"');const i="/account/targets/{targetId}/push".replace("{targetId}",t),s={};typeof e<"u"&&(s.identifier=e);const o=new URL(this.client.config.endpoint+i);return yield this.client.call("put",o,{"content-type":"application/json"},s)})}deletePushTarget(t){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "targetId"');const e="/account/targets/{targetId}/push".replace("{targetId}",t),i={},s=new URL(this.client.config.endpoint+e);return yield this.client.call("delete",s,{"content-type":"application/json"},i)})}createEmailToken(t,e,i){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "userId"');if(typeof e>"u")throw new h('Missing required parameter: "email"');const s="/account/tokens/email",o={};typeof t<"u"&&(o.userId=t),typeof e<"u"&&(o.email=e),typeof i<"u"&&(o.phrase=i);const r=new URL(this.client.config.endpoint+s);return yield this.client.call("post",r,{"content-type":"application/json"},o)})}createMagicURLToken(t,e,i,s){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "userId"');if(typeof e>"u")throw new h('Missing required parameter: "email"');const o="/account/tokens/magic-url",r={};typeof t<"u"&&(r.userId=t),typeof e<"u"&&(r.email=e),typeof i<"u"&&(r.url=i),typeof s<"u"&&(r.phrase=s);const c=new URL(this.client.config.endpoint+o);return yield this.client.call("post",c,{"content-type":"application/json"},r)})}createOAuth2Token(t,e,i,s){if(typeof t>"u")throw new h('Missing required parameter: "provider"');const o="/account/tokens/oauth2/{provider}".replace("{provider}",t),r={};typeof e<"u"&&(r.success=e),typeof i<"u"&&(r.failure=i),typeof s<"u"&&(r.scopes=s);const c=new URL(this.client.config.endpoint+o);r.project=this.client.config.project;for(const[a,l]of Object.entries(E.flatten(r)))c.searchParams.append(a,l);if(typeof window<"u"&&(window!=null&&window.location))window.location.href=c.toString();else return c}createPhoneToken(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "userId"');if(typeof e>"u")throw new h('Missing required parameter: "phone"');const i="/account/tokens/phone",s={};typeof t<"u"&&(s.userId=t),typeof e<"u"&&(s.phone=e);const o=new URL(this.client.config.endpoint+i);return yield this.client.call("post",o,{"content-type":"application/json"},s)})}createVerification(t){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "url"');const e="/account/verification",i={};typeof t<"u"&&(i.url=t);const s=new URL(this.client.config.endpoint+e);return yield this.client.call("post",s,{"content-type":"application/json"},i)})}updateVerification(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "userId"');if(typeof e>"u")throw new h('Missing required parameter: "secret"');const i="/account/verification",s={};typeof t<"u"&&(s.userId=t),typeof e<"u"&&(s.secret=e);const o=new URL(this.client.config.endpoint+i);return yield this.client.call("put",o,{"content-type":"application/json"},s)})}createPhoneVerification(){return f(this,void 0,void 0,function*(){const t="/account/verification/phone",e={},i=new URL(this.client.config.endpoint+t);return yield this.client.call("post",i,{"content-type":"application/json"},e)})}updatePhoneVerification(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "userId"');if(typeof e>"u")throw new h('Missing required parameter: "secret"');const i="/account/verification/phone",s={};typeof t<"u"&&(s.userId=t),typeof e<"u"&&(s.secret=e);const o=new URL(this.client.config.endpoint+i);return yield this.client.call("put",o,{"content-type":"application/json"},s)})}}class Wn extends E{constructor(t){super(t)}listDocuments(t,e,i){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "databaseId"');if(typeof e>"u")throw new h('Missing required parameter: "collectionId"');const s="/databases/{databaseId}/collections/{collectionId}/documents".replace("{databaseId}",t).replace("{collectionId}",e),o={};typeof i<"u"&&(o.queries=i);const r=new URL(this.client.config.endpoint+s);return yield this.client.call("get",r,{"content-type":"application/json"},o)})}createDocument(t,e,i,s,o){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "databaseId"');if(typeof e>"u")throw new h('Missing required parameter: "collectionId"');if(typeof i>"u")throw new h('Missing required parameter: "documentId"');if(typeof s>"u")throw new h('Missing required parameter: "data"');const r="/databases/{databaseId}/collections/{collectionId}/documents".replace("{databaseId}",t).replace("{collectionId}",e),c={};typeof i<"u"&&(c.documentId=i),typeof s<"u"&&(c.data=s),typeof o<"u"&&(c.permissions=o);const a=new URL(this.client.config.endpoint+r);return yield this.client.call("post",a,{"content-type":"application/json"},c)})}getDocument(t,e,i,s){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "databaseId"');if(typeof e>"u")throw new h('Missing required parameter: "collectionId"');if(typeof i>"u")throw new h('Missing required parameter: "documentId"');const o="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",t).replace("{collectionId}",e).replace("{documentId}",i),r={};typeof s<"u"&&(r.queries=s);const c=new URL(this.client.config.endpoint+o);return yield this.client.call("get",c,{"content-type":"application/json"},r)})}updateDocument(t,e,i,s,o){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "databaseId"');if(typeof e>"u")throw new h('Missing required parameter: "collectionId"');if(typeof i>"u")throw new h('Missing required parameter: "documentId"');const r="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",t).replace("{collectionId}",e).replace("{documentId}",i),c={};typeof s<"u"&&(c.data=s),typeof o<"u"&&(c.permissions=o);const a=new URL(this.client.config.endpoint+r);return yield this.client.call("patch",a,{"content-type":"application/json"},c)})}deleteDocument(t,e,i){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "databaseId"');if(typeof e>"u")throw new h('Missing required parameter: "collectionId"');if(typeof i>"u")throw new h('Missing required parameter: "documentId"');const s="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",t).replace("{collectionId}",e).replace("{documentId}",i),o={},r=new URL(this.client.config.endpoint+s);return yield this.client.call("delete",r,{"content-type":"application/json"},o)})}}class Gn extends E{constructor(t){super(t)}listExecutions(t,e,i){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "functionId"');const s="/functions/{functionId}/executions".replace("{functionId}",t),o={};typeof e<"u"&&(o.queries=e),typeof i<"u"&&(o.search=i);const r=new URL(this.client.config.endpoint+s);return yield this.client.call("get",r,{"content-type":"application/json"},o)})}createExecution(t,e,i,s,o,r){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "functionId"');const c="/functions/{functionId}/executions".replace("{functionId}",t),a={};typeof e<"u"&&(a.body=e),typeof i<"u"&&(a.async=i),typeof s<"u"&&(a.path=s),typeof o<"u"&&(a.method=o),typeof r<"u"&&(a.headers=r);const l=new URL(this.client.config.endpoint+c);return yield this.client.call("post",l,{"content-type":"application/json"},a)})}getExecution(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "functionId"');if(typeof e>"u")throw new h('Missing required parameter: "executionId"');const i="/functions/{functionId}/executions/{executionId}".replace("{functionId}",t).replace("{executionId}",e),s={},o=new URL(this.client.config.endpoint+i);return yield this.client.call("get",o,{"content-type":"application/json"},s)})}}class Hn extends E{constructor(t){super(t)}listFiles(t,e,i){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "bucketId"');const s="/storage/buckets/{bucketId}/files".replace("{bucketId}",t),o={};typeof e<"u"&&(o.queries=e),typeof i<"u"&&(o.search=i);const r=new URL(this.client.config.endpoint+s);return yield this.client.call("get",r,{"content-type":"application/json"},o)})}createFile(t,e,i,s,o=r=>{}){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "bucketId"');if(typeof e>"u")throw new h('Missing required parameter: "fileId"');if(typeof i>"u")throw new h('Missing required parameter: "file"');const r="/storage/buckets/{bucketId}/files".replace("{bucketId}",t),c={};typeof e<"u"&&(c.fileId=e),typeof i<"u"&&(c.file=i),typeof s<"u"&&(c.permissions=s);const a=new URL(this.client.config.endpoint+r);if(!(i instanceof File))throw new h('Parameter "file" has to be a File.');const l=i.size;if(l<=E.CHUNK_SIZE)return yield this.client.call("post",a,{"content-type":"multipart/form-data"},c);const d={"content-type":"multipart/form-data"};let u=0,g;if(e!="unique()")try{g=yield this.client.call("GET",new URL(this.client.config.endpoint+r+"/"+e),d),u=g.chunksUploaded*E.CHUNK_SIZE}catch{}for(;u<l;){let p=Math.min(u+E.CHUNK_SIZE-1,l-1);d["content-range"]="bytes "+u+"-"+p+"/"+l,g&&g.$id&&(d["x-appwrite-id"]=g.$id);const w=i.slice(u,p+1);c.file=new File([w],i.name),g=yield this.client.call("post",a,d,c),o&&o({$id:g.$id,progress:u/l*100,sizeUploaded:u,chunksTotal:g.chunksTotal,chunksUploaded:g.chunksUploaded}),u+=E.CHUNK_SIZE}return g})}getFile(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "bucketId"');if(typeof e>"u")throw new h('Missing required parameter: "fileId"');const i="/storage/buckets/{bucketId}/files/{fileId}".replace("{bucketId}",t).replace("{fileId}",e),s={},o=new URL(this.client.config.endpoint+i);return yield this.client.call("get",o,{"content-type":"application/json"},s)})}updateFile(t,e,i,s){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "bucketId"');if(typeof e>"u")throw new h('Missing required parameter: "fileId"');const o="/storage/buckets/{bucketId}/files/{fileId}".replace("{bucketId}",t).replace("{fileId}",e),r={};typeof i<"u"&&(r.name=i),typeof s<"u"&&(r.permissions=s);const c=new URL(this.client.config.endpoint+o);return yield this.client.call("put",c,{"content-type":"application/json"},r)})}deleteFile(t,e){return f(this,void 0,void 0,function*(){if(typeof t>"u")throw new h('Missing required parameter: "bucketId"');if(typeof e>"u")throw new h('Missing required parameter: "fileId"');const i="/storage/buckets/{bucketId}/files/{fileId}".replace("{bucketId}",t).replace("{fileId}",e),s={},o=new URL(this.client.config.endpoint+i);return yield this.client.call("delete",o,{"content-type":"application/json"},s)})}getFileDownload(t,e){if(typeof t>"u")throw new h('Missing required parameter: "bucketId"');if(typeof e>"u")throw new h('Missing required parameter: "fileId"');const i="/storage/buckets/{bucketId}/files/{fileId}/download".replace("{bucketId}",t).replace("{fileId}",e),s={},o=new URL(this.client.config.endpoint+i);s.project=this.client.config.project;for(const[r,c]of Object.entries(E.flatten(s)))o.searchParams.append(r,c);return o}getFilePreview(t,e,i,s,o,r,c,a,l,d,u,g,p){if(typeof t>"u")throw new h('Missing required parameter: "bucketId"');if(typeof e>"u")throw new h('Missing required parameter: "fileId"');const w="/storage/buckets/{bucketId}/files/{fileId}/preview".replace("{bucketId}",t).replace("{fileId}",e),y={};typeof i<"u"&&(y.width=i),typeof s<"u"&&(y.height=s),typeof o<"u"&&(y.gravity=o),typeof r<"u"&&(y.quality=r),typeof c<"u"&&(y.borderWidth=c),typeof a<"u"&&(y.borderColor=a),typeof l<"u"&&(y.borderRadius=l),typeof d<"u"&&(y.opacity=d),typeof u<"u"&&(y.rotation=u),typeof g<"u"&&(y.background=g),typeof p<"u"&&(y.output=p);const he=new URL(this.client.config.endpoint+w);y.project=this.client.config.project;for(const[On,Bn]of Object.entries(E.flatten(y)))he.searchParams.append(On,Bn);return he}getFileView(t,e){if(typeof t>"u")throw new h('Missing required parameter: "bucketId"');if(typeof e>"u")throw new h('Missing required parameter: "fileId"');const i="/storage/buckets/{bucketId}/files/{fileId}/view".replace("{bucketId}",t).replace("{fileId}",e),s={},o=new URL(this.client.config.endpoint+i);s.project=this.client.config.project;for(const[r,c]of Object.entries(E.flatten(s)))o.searchParams.append(r,c);return o}}var ue;(function(n){n.Totp="totp"})(ue||(ue={}));var fe;(function(n){n.Email="email",n.Phone="phone",n.Totp="totp",n.Recoverycode="recoverycode"})(fe||(fe={}));var pe;(function(n){n.Amazon="amazon",n.Apple="apple",n.Auth0="auth0",n.Authentik="authentik",n.Autodesk="autodesk",n.Bitbucket="bitbucket",n.Bitly="bitly",n.Box="box",n.Dailymotion="dailymotion",n.Discord="discord",n.Disqus="disqus",n.Dropbox="dropbox",n.Etsy="etsy",n.Facebook="facebook",n.Github="github",n.Gitlab="gitlab",n.Google="google",n.Linkedin="linkedin",n.Microsoft="microsoft",n.Notion="notion",n.Oidc="oidc",n.Okta="okta",n.Paypal="paypal",n.PaypalSandbox="paypalSandbox",n.Podio="podio",n.Salesforce="salesforce",n.Slack="slack",n.Spotify="spotify",n.Stripe="stripe",n.Tradeshift="tradeshift",n.TradeshiftBox="tradeshiftBox",n.Twitch="twitch",n.Wordpress="wordpress",n.Yahoo="yahoo",n.Yammer="yammer",n.Yandex="yandex",n.Zoho="zoho",n.Zoom="zoom",n.Mock="mock"})(pe||(pe={}));var ge;(function(n){n.AvantBrowser="aa",n.AndroidWebViewBeta="an",n.GoogleChrome="ch",n.GoogleChromeIOS="ci",n.GoogleChromeMobile="cm",n.Chromium="cr",n.MozillaFirefox="ff",n.Safari="sf",n.MobileSafari="mf",n.MicrosoftEdge="ps",n.MicrosoftEdgeIOS="oi",n.OperaMini="om",n.Opera="op",n.OperaNext="on"})(ge||(ge={}));var ye;(function(n){n.AmericanExpress="amex",n.Argencard="argencard",n.Cabal="cabal",n.Cencosud="cencosud",n.DinersClub="diners",n.Discover="discover",n.Elo="elo",n.Hipercard="hipercard",n.JCB="jcb",n.Mastercard="mastercard",n.Naranja="naranja",n.TarjetaShopping="targeta-shopping",n.UnionChinaPay="union-china-pay",n.Visa="visa",n.MIR="mir",n.Maestro="maestro"})(ye||(ye={}));var we;(function(n){n.Afghanistan="af",n.Angola="ao",n.Albania="al",n.Andorra="ad",n.UnitedArabEmirates="ae",n.Argentina="ar",n.Armenia="am",n.AntiguaAndBarbuda="ag",n.Australia="au",n.Austria="at",n.Azerbaijan="az",n.Burundi="bi",n.Belgium="be",n.Benin="bj",n.BurkinaFaso="bf",n.Bangladesh="bd",n.Bulgaria="bg",n.Bahrain="bh",n.Bahamas="bs",n.BosniaAndHerzegovina="ba",n.Belarus="by",n.Belize="bz",n.Bolivia="bo",n.Brazil="br",n.Barbados="bb",n.BruneiDarussalam="bn",n.Bhutan="bt",n.Botswana="bw",n.CentralAfricanRepublic="cf",n.Canada="ca",n.Switzerland="ch",n.Chile="cl",n.China="cn",n.CoteDIvoire="ci",n.Cameroon="cm",n.DemocraticRepublicOfTheCongo="cd",n.RepublicOfTheCongo="cg",n.Colombia="co",n.Comoros="km",n.CapeVerde="cv",n.CostaRica="cr",n.Cuba="cu",n.Cyprus="cy",n.CzechRepublic="cz",n.Germany="de",n.Djibouti="dj",n.Dominica="dm",n.Denmark="dk",n.DominicanRepublic="do",n.Algeria="dz",n.Ecuador="ec",n.Egypt="eg",n.Eritrea="er",n.Spain="es",n.Estonia="ee",n.Ethiopia="et",n.Finland="fi",n.Fiji="fj",n.France="fr",n.MicronesiaFederatedStatesOf="fm",n.Gabon="ga",n.UnitedKingdom="gb",n.Georgia="ge",n.Ghana="gh",n.Guinea="gn",n.Gambia="gm",n.GuineaBissau="gw",n.EquatorialGuinea="gq",n.Greece="gr",n.Grenada="gd",n.Guatemala="gt",n.Guyana="gy",n.Honduras="hn",n.Croatia="hr",n.Haiti="ht",n.Hungary="hu",n.Indonesia="id",n.India="in",n.Ireland="ie",n.IranIslamicRepublicOf="ir",n.Iraq="iq",n.Iceland="is",n.Israel="il",n.Italy="it",n.Jamaica="jm",n.Jordan="jo",n.Japan="jp",n.Kazakhstan="kz",n.Kenya="ke",n.Kyrgyzstan="kg",n.Cambodia="kh",n.Kiribati="ki",n.SaintKittsAndNevis="kn",n.SouthKorea="kr",n.Kuwait="kw",n.LaoPeopleSDemocraticRepublic="la",n.Lebanon="lb",n.Liberia="lr",n.Libya="ly",n.SaintLucia="lc",n.Liechtenstein="li",n.SriLanka="lk",n.Lesotho="ls",n.Lithuania="lt",n.Luxembourg="lu",n.Latvia="lv",n.Morocco="ma",n.Monaco="mc",n.Moldova="md",n.Madagascar="mg",n.Maldives="mv",n.Mexico="mx",n.MarshallIslands="mh",n.NorthMacedonia="mk",n.Mali="ml",n.Malta="mt",n.Myanmar="mm",n.Montenegro="me",n.Mongolia="mn",n.Mozambique="mz",n.Mauritania="mr",n.Mauritius="mu",n.Malawi="mw",n.Malaysia="my",n.Namibia="na",n.Niger="ne",n.Nigeria="ng",n.Nicaragua="ni",n.Netherlands="nl",n.Norway="no",n.Nepal="np",n.Nauru="nr",n.NewZealand="nz",n.Oman="om",n.Pakistan="pk",n.Panama="pa",n.Peru="pe",n.Philippines="ph",n.Palau="pw",n.PapuaNewGuinea="pg",n.Poland="pl",n.FrenchPolynesia="pf",n.NorthKorea="kp",n.Portugal="pt",n.Paraguay="py",n.Qatar="qa",n.Romania="ro",n.Russia="ru",n.Rwanda="rw",n.SaudiArabia="sa",n.Sudan="sd",n.Senegal="sn",n.Singapore="sg",n.SolomonIslands="sb",n.SierraLeone="sl",n.ElSalvador="sv",n.SanMarino="sm",n.Somalia="so",n.Serbia="rs",n.SouthSudan="ss",n.SaoTomeAndPrincipe="st",n.Suriname="sr",n.Slovakia="sk",n.Slovenia="si",n.Sweden="se",n.Eswatini="sz",n.Seychelles="sc",n.Syria="sy",n.Chad="td",n.Togo="tg",n.Thailand="th",n.Tajikistan="tj",n.Turkmenistan="tm",n.TimorLeste="tl",n.Tonga="to",n.TrinidadAndTobago="tt",n.Tunisia="tn",n.Turkey="tr",n.Tuvalu="tv",n.Tanzania="tz",n.Uganda="ug",n.Ukraine="ua",n.Uruguay="uy",n.UnitedStates="us",n.Uzbekistan="uz",n.VaticanCity="va",n.SaintVincentAndTheGrenadines="vc",n.Venezuela="ve",n.Vietnam="vn",n.Vanuatu="vu",n.Samoa="ws",n.Yemen="ye",n.SouthAfrica="za",n.Zambia="zm",n.Zimbabwe="zw"})(we||(we={}));var me;(function(n){n.GET="GET",n.POST="POST",n.PUT="PUT",n.PATCH="PATCH",n.DELETE="DELETE",n.OPTIONS="OPTIONS"})(me||(me={}));var be;(function(n){n.Center="center",n.Topleft="top-left",n.Top="top",n.Topright="top-right",n.Left="left",n.Right="right",n.Bottomleft="bottom-left",n.Bottom="bottom",n.Bottomright="bottom-right"})(be||(be={}));var ke;(function(n){n.Jpg="jpg",n.Jpeg="jpeg",n.Gif="gif",n.Png="png",n.Webp="webp"})(ke||(ke={}));class $n{constructor(){_(this,"client");_(this,"account");_(this,"databases");_(this,"storage");_(this,"functions");this.client=new Vn().setEndpoint("http://localhost/v1").setProject("open-tech-lab"),this.account=new zn(this.client),this.databases=new Wn(this.client),this.storage=new Hn(this.client),this.functions=new Gn(this.client)}async getCurrentUser(){try{return await this.account.get()}catch{return null}}async login(t,e){return await this.account.createEmailPasswordSession(t,e)}async logout(){return await this.account.deleteSession("current")}async createProject(t){return await this.databases.createDocument("main","projects","unique()",t)}async getProjects(){return(await this.databases.listDocuments("main","projects")).documents}async updateProject(t,e){return await this.databases.updateDocument("main","projects",t,e)}async deleteProject(t){return await this.databases.deleteDocument("main","projects",t)}subscribeToProject(t,e){return this.client.subscribe(`databases.main.collections.projects.documents.${t}`,e)}async executeFunction(t,e){return await this.functions.createExecution(t,JSON.stringify(e))}}const Wt=(n,t)=>t.some(e=>n instanceof e);let ve,Se;function Jn(){return ve||(ve=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Kn(){return Se||(Se=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Gt=new WeakMap,Tt=new WeakMap,jt=new WeakMap;function Yn(n){const t=new Promise((e,i)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",r)},o=()=>{e(z(n.result)),s()},r=()=>{i(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",r)});return jt.set(t,n),t}function Zn(n){if(Gt.has(n))return;const t=new Promise((e,i)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",r),n.removeEventListener("abort",r)},o=()=>{e(),s()},r=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",r),n.addEventListener("abort",r)});Gt.set(n,t)}let Ht={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return Gt.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return z(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function Je(n){Ht=n(Ht)}function Xn(n){return Kn().includes(n)?function(...t){return n.apply($t(this),t),z(this.request)}:function(...t){return z(n.apply($t(this),t))}}function Qn(n){return typeof n=="function"?Xn(n):(n instanceof IDBTransaction&&Zn(n),Wt(n,Jn())?new Proxy(n,Ht):n)}function z(n){if(n instanceof IDBRequest)return Yn(n);if(Tt.has(n))return Tt.get(n);const t=Qn(n);return t!==n&&(Tt.set(n,t),jt.set(t,n)),t}const $t=n=>jt.get(n);function Fn(n,t,{blocked:e,upgrade:i,blocking:s,terminated:o}={}){const r=indexedDB.open(n,t),c=z(r);return i&&r.addEventListener("upgradeneeded",a=>{i(z(r.result),a.oldVersion,a.newVersion,z(r.transaction),a)}),e&&r.addEventListener("blocked",a=>e(a.oldVersion,a.newVersion,a)),c.then(a=>{o&&a.addEventListener("close",()=>o()),s&&a.addEventListener("versionchange",l=>s(l.oldVersion,l.newVersion,l))}).catch(()=>{}),c}const ti=["get","getKey","getAll","getAllKeys","count"],ei=["put","add","delete","clear"],Rt=new Map;function _e(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(Rt.get(t))return Rt.get(t);const e=t.replace(/FromIndex$/,""),i=t!==e,s=ei.includes(e);if(!(e in(i?IDBIndex:IDBObjectStore).prototype)||!(s||ti.includes(e)))return;const o=async function(r,...c){const a=this.transaction(r,s?"readwrite":"readonly");let l=a.store;return i&&(l=l.index(c.shift())),(await Promise.all([l[e](...c),s&&a.done]))[0]};return Rt.set(t,o),o}Je(n=>({...n,get:(t,e,i)=>_e(t,e)||n.get(t,e,i),has:(t,e)=>!!_e(t,e)||n.has(t,e)}));const ni=["continue","continuePrimaryKey","advance"],Ee={},Jt=new WeakMap,Ke=new WeakMap,ii={get(n,t){if(!ni.includes(t))return n[t];let e=Ee[t];return e||(e=Ee[t]=function(...i){Jt.set(this,Ke.get(this)[t](...i))}),e}};async function*si(...n){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...n)),!t)return;t=t;const e=new Proxy(t,ii);for(Ke.set(e,t),jt.set(e,$t(t));t;)yield e,t=await(Jt.get(e)||t.continue()),Jt.delete(e)}function Ie(n,t){return t===Symbol.asyncIterator&&Wt(n,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&Wt(n,[IDBIndex,IDBObjectStore])}Je(n=>({...n,get(t,e,i){return Ie(t,e)?si:n.get(t,e,i)},has(t,e){return Ie(t,e)||n.has(t,e)}}));class oi{constructor(){_(this,"db",null)}async init(){this.db=await Fn("open-tech-lab",1,{upgrade(t){t.objectStoreNames.contains("projects")||t.createObjectStore("projects",{keyPath:"id"}),t.objectStoreNames.contains("pendingSync")||t.createObjectStore("pendingSync",{keyPath:"id",autoIncrement:!0}).createIndex("timestamp","timestamp")}})}async saveProject(t){this.db||await this.init();const e=new Date().toISOString();await this.db.put("projects",{...t,name:t.name||"",description:t.description||"",files:t.files||{},createdAt:t.createdAt||e,updatedAt:t.updatedAt||e,lastSynced:Date.now(),pendingChanges:!1})}async getProject(t){return this.db||await this.init(),await this.db.get("projects",t)}async getAllProjects(){return this.db||await this.init(),await this.db.getAll("projects")}async deleteProject(t){this.db||await this.init(),await this.db.delete("projects",t)}async addPendingSync(t,e,i){this.db||await this.init(),await this.db.add("pendingSync",{id:crypto.randomUUID(),projectId:e,action:t,data:i,timestamp:Date.now()})}async getPendingSync(){return this.db||await this.init(),await this.db.getAll("pendingSync")}async clearPendingSync(t){this.db||await this.init(),await this.db.delete("pendingSync",t)}}class ri{constructor(t,e){_(this,"syncInterval",null);this.appwrite=t,this.storage=e}start(){this.syncInterval=window.setInterval(()=>{navigator.onLine&&this.syncPendingChanges()},3e4)}stop(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null)}async syncPendingChanges(){const t=await this.storage.getPendingSync();for(const e of t)try{switch(e.action){case"create":await this.appwrite.createProject(e.data);break;case"update":await this.appwrite.updateProject(e.projectId,e.data);break;case"delete":await this.appwrite.deleteProject(e.projectId);break}await this.storage.clearPendingSync(e.id)}catch(i){console.error("Sync failed for item:",e.id,i)}}async downloadProjects(){try{const t=await this.appwrite.getProjects();for(const e of t)await this.storage.saveProject(e)}catch(t){console.error("Failed to download projects:",t)}}}class ci{constructor(t,e){this.appwrite=t,this.storage=e}async render(t){var s;t.innerHTML=`
      <div class="project-list-header">
        <h2>Your Projects</h2>
        <button id="new-project-btn" class="btn-primary">New Project</button>
      </div>
      <div id="projects-container"></div>
    `;const e=t.querySelector("#projects-container");let i;try{if(navigator.onLine){i=await this.appwrite.getProjects();for(const o of i)await this.storage.saveProject(o)}else i=await this.storage.getAllProjects()}catch{i=await this.storage.getAllProjects()}if(i.length===0){e.innerHTML="<p>No projects yet. Create your first one!</p>";return}e.innerHTML=i.map(o=>`
        <div class="project-card" data-id="${o.id}">
          <h3>${o.name}</h3>
          <p>${o.description}</p>
          <div class="project-meta">
            <span>Files: ${Object.keys(o.files).length}</span>
            <span>Updated: ${new Date(o.updatedAt).toLocaleDateString()}</span>
          </div>
        </div>
      `).join(""),(s=document.getElementById("new-project-btn"))==null||s.addEventListener("click",()=>{this.createNewProject()}),e.querySelectorAll(".project-card").forEach(o=>{o.addEventListener("click",()=>{const r=o.getAttribute("data-id");this.openProject(r)})})}async createNewProject(){const t=prompt("Project name:");if(!t)return;const e=prompt("Description:"),i={name:t,description:e||"",files:{"main.js":`// Start coding here
`}};try{if(navigator.onLine)await this.appwrite.createProject(i);else{const s=crypto.randomUUID(),o=new Date().toISOString();await this.storage.saveProject({...i,id:s,createdAt:o,updatedAt:o}),await this.storage.addPendingSync("create",s,i)}this.render(document.getElementById("project-list"))}catch(s){console.error("Failed to create project:",s),alert("Failed to create project")}}openProject(t){console.log("Opening project:",t)}}const D=()=>new Map,Kt=n=>{const t=D();return n.forEach((e,i)=>{t.set(i,e)}),t},Q=(n,t,e)=>{let i=n.get(t);return i===void 0&&n.set(t,i=e()),i},ai=(n,t)=>{const e=[];for(const[i,s]of n)e.push(t(s,i));return e},li=(n,t)=>{for(const[e,i]of n)if(t(i,e))return!0;return!1},J=()=>new Set,Ut=n=>n[n.length-1],K=Array.from,di=Array.isArray;class hi{constructor(){this._observers=D()}on(t,e){return Q(this._observers,t,J).add(e),e}once(t,e){const i=(...s)=>{this.off(t,i),e(...s)};this.on(t,i)}off(t,e){const i=this._observers.get(t);i!==void 0&&(i.delete(e),i.size===0&&this._observers.delete(t))}emit(t,e){return K((this._observers.get(t)||D()).values()).forEach(i=>i(...e))}destroy(){this._observers=D()}}const W=Math.floor,gt=Math.abs,Ye=(n,t)=>n<t?n:t,F=(n,t)=>n>t?n:t,ui=n=>n!==0?n<0:1/n<0,je=1,Me=2,Pt=4,xt=8,fi=32,Ze=64,bt=128,pi=31,Le=63,it=127,gi=2147483647,yi=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&W(n)===n),wi=n=>n.toLowerCase(),mi=/^\s*/g,bi=n=>n.replace(mi,""),ki=/([A-Z])/g,Ce=(n,t)=>bi(n.replace(ki,e=>`${t}${wi(e)}`)),vi=n=>{const t=unescape(encodeURIComponent(n)),e=t.length,i=new Uint8Array(e);for(let s=0;s<e;s++)i[s]=t.codePointAt(s);return i},ot=typeof TextEncoder<"u"?new TextEncoder:null,Si=n=>ot.encode(n),_i=ot?Si:vi;let Ot=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Ot&&Ot.decode(new Uint8Array).length===1&&(Ot=null);class ht{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const ee=()=>new ht,Ei=n=>{let t=n.cpos;for(let e=0;e<n.bufs.length;e++)t+=n.bufs[e].length;return t},U=n=>{const t=new Uint8Array(Ei(n));let e=0;for(let i=0;i<n.bufs.length;i++){const s=n.bufs[i];t.set(s,e),e+=s.length}return t.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),e),t},Ii=(n,t)=>{const e=n.cbuf.length;e-n.cpos<t&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(F(e,t)*2),n.cpos=0)},v=(n,t)=>{const e=n.cbuf.length;n.cpos===e&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(e*2),n.cpos=0),n.cbuf[n.cpos++]=t},Yt=v,m=(n,t)=>{for(;t>it;)v(n,bt|it&t),t=W(t/128);v(n,it&t)},ne=(n,t)=>{const e=ui(t);for(e&&(t=-t),v(n,(t>Le?bt:0)|(e?Ze:0)|Le&t),t=W(t/64);t>0;)v(n,(t>it?bt:0)|it&t),t=W(t/128)},Zt=new Uint8Array(3e4),ji=Zt.length/3,Mi=(n,t)=>{if(t.length<ji){const e=ot.encodeInto(t,Zt).written||0;m(n,e);for(let i=0;i<e;i++)v(n,Zt[i])}else C(n,_i(t))},Li=(n,t)=>{const e=unescape(encodeURIComponent(t)),i=e.length;m(n,i);for(let s=0;s<i;s++)v(n,e.codePointAt(s))},$=ot&&ot.encodeInto?Mi:Li,ie=(n,t)=>{const e=n.cbuf.length,i=n.cpos,s=Ye(e-i,t.length),o=t.length-s;n.cbuf.set(t.subarray(0,s),i),n.cpos+=s,o>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(F(e*2,o)),n.cbuf.set(t.subarray(s)),n.cpos=o)},C=(n,t)=>{m(n,t.byteLength),ie(n,t)},se=(n,t)=>{Ii(n,t);const e=new DataView(n.cbuf.buffer,n.cpos,t);return n.cpos+=t,e},Ci=(n,t)=>se(n,4).setFloat32(0,t,!1),Ai=(n,t)=>se(n,8).setFloat64(0,t,!1),Di=(n,t)=>se(n,8).setBigInt64(0,t,!1),Ae=new DataView(new ArrayBuffer(4)),Ti=n=>(Ae.setFloat32(0,n),Ae.getFloat32(0)===n),rt=(n,t)=>{switch(typeof t){case"string":v(n,119),$(n,t);break;case"number":yi(t)&&gt(t)<=gi?(v(n,125),ne(n,t)):Ti(t)?(v(n,124),Ci(n,t)):(v(n,123),Ai(n,t));break;case"bigint":v(n,122),Di(n,t);break;case"object":if(t===null)v(n,126);else if(di(t)){v(n,117),m(n,t.length);for(let e=0;e<t.length;e++)rt(n,t[e])}else if(t instanceof Uint8Array)v(n,116),C(n,t);else{v(n,118);const e=Object.keys(t);m(n,e.length);for(let i=0;i<e.length;i++){const s=e[i];$(n,s),rt(n,t[s])}}break;case"boolean":v(n,t?120:121);break;default:v(n,127)}};class De extends ht{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&m(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Te=n=>{n.count>0&&(ne(n.encoder,n.count===1?n.s:-n.s),n.count>1&&m(n.encoder,n.count-2))};class yt{constructor(){this.encoder=new ht,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Te(this),this.count=1,this.s=t)}toUint8Array(){return Te(this),U(this.encoder)}}const Re=n=>{if(n.count>0){const t=n.diff*2+(n.count===1?0:1);ne(n.encoder,t),n.count>1&&m(n.encoder,n.count-2)}};class Bt{constructor(){this.encoder=new ht,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Re(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Re(this),U(this.encoder)}}class Ri{constructor(){this.sarr=[],this.s="",this.lensE=new yt}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new ht;return this.sarr.push(this.s),this.s="",$(t,this.sarr.join("")),ie(t,this.lensE.toUint8Array()),U(t)}}const Y=n=>new Error(n),T=()=>{throw Y("Method unimplemented")},G=()=>{throw Y("Unexpected case")},Ui=crypto.getRandomValues.bind(crypto),Xe=()=>Ui(new Uint32Array(1))[0],Pi="10000000-1000-4000-8000"+-1e11,xi=()=>Pi.replace(/[018]/g,n=>(n^Xe()&15>>n/4).toString(16)),Ue=n=>new Promise(n);Promise.all.bind(Promise);const Pe=n=>n===void 0?null:n;class Oi{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}}let Qe=new Oi,Bi=!0;try{typeof localStorage<"u"&&localStorage&&(Qe=localStorage,Bi=!1)}catch{}const qi=Qe,Ni=Object.assign,Vi=Object.keys,zi=(n,t)=>{for(const e in n)t(n[e],e)},xe=n=>Vi(n).length,Wi=n=>{for(const t in n)return!1;return!0},Gi=(n,t)=>{for(const e in n)if(!t(n[e],e))return!1;return!0},Hi=(n,t)=>Object.prototype.hasOwnProperty.call(n,t),$i=(n,t)=>n===t||xe(n)===xe(t)&&Gi(n,(e,i)=>(e!==void 0||Hi(t,i))&&t[i]===e),Ji=Object.freeze,Fe=n=>{for(const t in n){const e=n[t];(typeof e=="object"||typeof e=="function")&&Fe(n[t])}return Ji(n)},oe=(n,t,e=0)=>{try{for(;e<n.length;e++)n[e](...t)}finally{e<n.length&&oe(n,t,e+1)}},Ki=(n,t)=>t.includes(n);var tn={};const ct=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let A;const Yi=()=>{if(A===void 0)if(ct){A=D();const n=process.argv;let t=null;for(let e=0;e<n.length;e++){const i=n[e];i[0]==="-"?(t!==null&&A.set(t,""),t=i):t!==null&&(A.set(t,i),t=null)}t!==null&&A.set(t,"")}else typeof location=="object"?(A=D(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){const[t,e]=n.split("=");A.set(`--${Ce(t,"-")}`,e),A.set(`-${Ce(t,"-")}`,e)}})):A=D();return A},Xt=n=>Yi().has(n),kt=n=>Pe(ct?tn[n.toUpperCase().replaceAll("-","_")]:qi.getItem(n)),en=n=>Xt("--"+n)||kt(n)!==null;en("production");const Zi=ct&&Ki(tn.FORCE_COLOR,["true","1","2"]),Xi=Zi||!Xt("--no-colors")&&!en("no-color")&&(!ct||process.stdout.isTTY)&&(!ct||Xt("--color")||kt("COLORTERM")!==null||(kt("TERM")||"").includes("color"));class Qi{constructor(t,e){this.left=t,this.right=e}}const R=(n,t)=>new Qi(n,t);typeof DOMParser<"u"&&new DOMParser;const Fi=n=>ai(n,(t,e)=>`${e}:${t};`).join(""),O=Symbol,nn=O(),sn=O(),ts=O(),es=O(),ns=O(),on=O(),is=O(),re=O(),ss=O(),os=n=>{var s;n.length===1&&((s=n[0])==null?void 0:s.constructor)===Function&&(n=n[0]());const t=[],e=[];let i=0;for(;i<n.length;i++){const o=n[i];if(o===void 0)break;if(o.constructor===String||o.constructor===Number)t.push(o);else if(o.constructor===Object)break}for(i>0&&e.push(t.join(""));i<n.length;i++){const o=n[i];o instanceof Symbol||e.push(o)}return e},rs={[nn]:R("font-weight","bold"),[sn]:R("font-weight","normal"),[ts]:R("color","blue"),[ns]:R("color","green"),[es]:R("color","grey"),[on]:R("color","red"),[is]:R("color","purple"),[re]:R("color","orange"),[ss]:R("color","black")},cs=n=>{var r;n.length===1&&((r=n[0])==null?void 0:r.constructor)===Function&&(n=n[0]());const t=[],e=[],i=D();let s=[],o=0;for(;o<n.length;o++){const c=n[o],a=rs[c];if(a!==void 0)i.set(a.left,a.right);else{if(c===void 0)break;if(c.constructor===String||c.constructor===Number){const l=Fi(i);o>0||l.length>0?(t.push("%c"+c),e.push(l)):t.push(c)}else break}}for(o>0&&(s=e,s.unshift(t.join("")));o<n.length;o++){const c=n[o];c instanceof Symbol||s.push(c)}return s},rn=Xi?cs:os,as=(...n)=>{console.log(...rn(n)),cn.forEach(t=>t.print(n))},ls=(...n)=>{console.warn(...rn(n)),n.unshift(re),cn.forEach(t=>t.print(n))},cn=J(),an=n=>({[Symbol.iterator](){return this},next:n}),ds=(n,t)=>an(()=>{let e;do e=n.next();while(!e.done&&!t(e.value));return e}),qt=(n,t)=>an(()=>{const{done:e,value:i}=n.next();return{done:e,value:e?void 0:t(i)}});class hs{constructor(t,e){this.clock=t,this.len=e}}class us{constructor(){this.clients=new Map}}const ln=(n,t,e)=>t.clients.forEach((i,s)=>{const o=n.doc.store.clients.get(s);if(o!=null){const r=o[o.length-1],c=r.id.clock+r.length;for(let a=0,l=i[a];a<i.length&&l.clock<c;l=i[++a])yn(n,o,l.clock,l.len,e)}}),fs=(n,t)=>{let e=0,i=n.length-1;for(;e<=i;){const s=W((e+i)/2),o=n[s],r=o.clock;if(r<=t){if(t<r+o.len)return s;e=s+1}else i=s-1}return null},dn=(n,t)=>{const e=n.clients.get(t.client);return e!==void 0&&fs(e,t.clock)!==null},hn=n=>{n.clients.forEach(t=>{t.sort((s,o)=>s.clock-o.clock);let e,i;for(e=1,i=1;e<t.length;e++){const s=t[i-1],o=t[e];s.clock+s.len>=o.clock?s.len=F(s.len,o.clock+o.len-s.clock):(i<e&&(t[i]=o),i++)}t.length=i})},un=(n,t,e,i)=>{Q(n.clients,t,()=>[]).push(new hs(e,i))},ps=(n,t)=>{m(n.restEncoder,t.clients.size),K(t.clients.entries()).sort((e,i)=>i[0]-e[0]).forEach(([e,i])=>{n.resetDsCurVal(),m(n.restEncoder,e);const s=i.length;m(n.restEncoder,s);for(let o=0;o<s;o++){const r=i[o];n.writeDsClock(r.clock),n.writeDsLen(r.len)}})},fn=Xe;class tt extends hi{constructor({guid:t=xi(),collectionid:e=null,gc:i=!0,gcFilter:s=()=>!0,meta:o=null,autoLoad:r=!1,shouldLoad:c=!0}={}){super(),this.gc=i,this.gcFilter=s,this.clientID=fn(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new Es,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=r,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Ue(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const a=()=>Ue(l=>{const d=u=>{(u===void 0||u===!0)&&(this.off("sync",d),l())};this.on("sync",d)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=a()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=a()}load(){const t=this._item;t!==null&&!this.shouldLoad&&b(t.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(K(this.subdocs).map(t=>t.guid))}transact(t,e=null){return b(this,t,e)}get(t,e=I){const i=Q(this.share,t,()=>{const o=new e;return o._integrate(this,null),o}),s=i.constructor;if(e!==I&&s!==e)if(s===I){const o=new e;o._map=i._map,i._map.forEach(r=>{for(;r!==null;r=r.left)r.parent=o}),o._start=i._start;for(let r=o._start;r!==null;r=r.right)r.parent=o;return o._length=i._length,this.share.set(t,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return i}getArray(t=""){return this.get(t,st)}getText(t=""){return this.get(t,Et)}getMap(t=""){return this.get(t,_t)}getXmlElement(t=""){return this.get(t,dt)}getXmlFragment(t=""){return this.get(t,Z)}toJSON(){const t={};return this.share.forEach((e,i)=>{t[i]=e.toJSON()}),t}destroy(){this.isDestroyed=!0,K(this.subdocs).forEach(e=>e.destroy());const t=this._item;if(t!==null){this._item=null;const e=t.content;e.doc=new tt({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,b(t.parent.doc,i=>{const s=e.doc;t.deleted||i.subdocsAdded.add(s),i.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class gs{constructor(){this.restEncoder=ee()}toUint8Array(){return U(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){m(this.restEncoder,t)}writeDsLen(t){m(this.restEncoder,t)}}class ys extends gs{writeLeftID(t){m(this.restEncoder,t.client),m(this.restEncoder,t.clock)}writeRightID(t){m(this.restEncoder,t.client),m(this.restEncoder,t.clock)}writeClient(t){m(this.restEncoder,t)}writeInfo(t){Yt(this.restEncoder,t)}writeString(t){$(this.restEncoder,t)}writeParentInfo(t){m(this.restEncoder,t?1:0)}writeTypeRef(t){m(this.restEncoder,t)}writeLen(t){m(this.restEncoder,t)}writeAny(t){rt(this.restEncoder,t)}writeBuf(t){C(this.restEncoder,t)}writeJSON(t){$(this.restEncoder,JSON.stringify(t))}writeKey(t){$(this.restEncoder,t)}}class ws{constructor(){this.restEncoder=ee(),this.dsCurrVal=0}toUint8Array(){return U(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,m(this.restEncoder,e)}writeDsLen(t){t===0&&G(),m(this.restEncoder,t-1),this.dsCurrVal+=t}}class ms extends ws{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Bt,this.clientEncoder=new yt,this.leftClockEncoder=new Bt,this.rightClockEncoder=new Bt,this.infoEncoder=new De(Yt),this.stringEncoder=new Ri,this.parentInfoEncoder=new De(Yt),this.typeRefEncoder=new yt,this.lenEncoder=new yt}toUint8Array(){const t=ee();return m(t,0),C(t,this.keyClockEncoder.toUint8Array()),C(t,this.clientEncoder.toUint8Array()),C(t,this.leftClockEncoder.toUint8Array()),C(t,this.rightClockEncoder.toUint8Array()),C(t,U(this.infoEncoder)),C(t,this.stringEncoder.toUint8Array()),C(t,U(this.parentInfoEncoder)),C(t,this.typeRefEncoder.toUint8Array()),C(t,this.lenEncoder.toUint8Array()),ie(t,U(this.restEncoder)),U(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){rt(this.restEncoder,t)}writeBuf(t){C(this.restEncoder,t)}writeJSON(t){rt(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);e===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const bs=(n,t,e,i)=>{i=F(i,t[0].id.clock);const s=P(t,i);m(n.restEncoder,t.length-s),n.writeClient(e),m(n.restEncoder,i);const o=t[s];o.write(n,i-o.id.clock);for(let r=s+1;r<t.length;r++)t[r].write(n,0)},ks=(n,t,e)=>{const i=new Map;e.forEach((s,o)=>{L(t,o)>s&&i.set(o,s)}),ce(t).forEach((s,o)=>{e.has(o)||i.set(o,0)}),m(n.restEncoder,i.size),K(i.entries()).sort((s,o)=>o[0]-s[0]).forEach(([s,o])=>{bs(n,t.clients.get(s),s,o)})},vs=(n,t)=>ks(n,t.doc.store,t.beforeState);class Ss{constructor(){this.l=[]}}const Oe=()=>new Ss,Be=(n,t)=>n.l.push(t),qe=(n,t)=>{const e=n.l,i=e.length;n.l=e.filter(s=>t!==s),i===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},pn=(n,t,e)=>oe(n.l,[t,e]);class wt{constructor(t,e){this.client=t,this.clock=e}}const ut=(n,t)=>n===t||n!==null&&t!==null&&n.client===t.client&&n.clock===t.clock,k=(n,t)=>new wt(n,t),_s=n=>{for(const[t,e]of n.doc.share.entries())if(e===n)return t;throw G()},H=(n,t)=>t===void 0?!n.deleted:t.sv.has(n.id.client)&&(t.sv.get(n.id.client)||0)>n.id.clock&&!dn(t.ds,n.id),Qt=(n,t)=>{const e=Q(n.meta,Qt,J),i=n.doc.store;e.has(t)||(t.sv.forEach((s,o)=>{s<L(i,o)&&N(n,k(o,s))}),ln(n,t.ds,s=>{}),e.add(t))};class Es{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const ce=n=>{const t=new Map;return n.clients.forEach((e,i)=>{const s=e[e.length-1];t.set(i,s.id.clock+s.length)}),t},L=(n,t)=>{const e=n.clients.get(t);if(e===void 0)return 0;const i=e[e.length-1];return i.id.clock+i.length},gn=(n,t)=>{let e=n.clients.get(t.id.client);if(e===void 0)e=[],n.clients.set(t.id.client,e);else{const i=e[e.length-1];if(i.id.clock+i.length!==t.id.clock)throw G()}e.push(t)},P=(n,t)=>{let e=0,i=n.length-1,s=n[i],o=s.id.clock;if(o===t)return i;let r=W(t/(o+s.length-1)*i);for(;e<=i;){if(s=n[r],o=s.id.clock,o<=t){if(t<o+s.length)return r;e=r+1}else i=r-1;r=W((e+i)/2)}throw G()},Is=(n,t)=>{const e=n.clients.get(t.client);return e[P(e,t.clock)]},Nt=Is,Ft=(n,t,e)=>{const i=P(t,e),s=t[i];return s.id.clock<e&&s instanceof j?(t.splice(i+1,0,Un(n,s,e-s.id.clock)),i+1):i},N=(n,t)=>{const e=n.doc.store.clients.get(t.client);return e[Ft(n,e,t.clock)]},Ne=(n,t,e)=>{const i=t.clients.get(e.client),s=P(i,e.clock),o=i[s];return e.clock!==o.id.clock+o.length-1&&o.constructor!==B&&i.splice(s+1,0,Un(n,o,e.clock-o.id.clock+1)),o},js=(n,t,e)=>{const i=n.clients.get(t.id.client);i[P(i,t.id.clock)]=e},yn=(n,t,e,i,s)=>{if(i===0)return;const o=e+i;let r=Ft(n,t,e),c;do c=t[r++],o<c.id.clock+c.length&&Ft(n,t,o),s(c);while(r<t.length&&t[r].id.clock<o)};class Ms{constructor(t,e,i){this.doc=t,this.deleteSet=new us,this.beforeState=ce(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=i,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Ve=(n,t)=>t.deleteSet.clients.size===0&&!li(t.afterState,(e,i)=>t.beforeState.get(i)!==e)?!1:(hn(t.deleteSet),vs(n,t),ps(n,t.deleteSet),!0),ze=(n,t,e)=>{const i=t._item;(i===null||i.id.clock<(n.beforeState.get(i.id.client)||0)&&!i.deleted)&&Q(n.changed,t,J).add(e)},mt=(n,t)=>{let e=n[t],i=n[t-1],s=t;for(;s>0;e=i,i=n[--s-1]){if(i.deleted===e.deleted&&i.constructor===e.constructor&&i.mergeWith(e)){e instanceof j&&e.parentSub!==null&&e.parent._map.get(e.parentSub)===e&&e.parent._map.set(e.parentSub,i);continue}break}const o=t-s;return o&&n.splice(t+1-o,o),o},Ls=(n,t,e)=>{for(const[i,s]of n.clients.entries()){const o=t.clients.get(i);for(let r=s.length-1;r>=0;r--){const c=s[r],a=c.clock+c.len;for(let l=P(o,c.clock),d=o[l];l<o.length&&d.id.clock<a;d=o[++l]){const u=o[l];if(c.clock+c.len<=u.id.clock)break;u instanceof j&&u.deleted&&!u.keep&&e(u)&&u.gc(t,!1)}}}},Cs=(n,t)=>{n.clients.forEach((e,i)=>{const s=t.clients.get(i);for(let o=e.length-1;o>=0;o--){const r=e[o],c=Ye(s.length-1,1+P(s,r.clock+r.len-1));for(let a=c,l=s[a];a>0&&l.id.clock>=r.clock;l=s[a])a-=1+mt(s,a)}})},wn=(n,t)=>{if(t<n.length){const e=n[t],i=e.doc,s=i.store,o=e.deleteSet,r=e._mergeStructs;try{hn(o),e.afterState=ce(e.doc.store),i.emit("beforeObserverCalls",[e,i]);const c=[];e.changed.forEach((a,l)=>c.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(e,a)})),c.push(()=>{e.changedParentTypes.forEach((a,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(a=a.filter(d=>d.target._item===null||!d.target._item.deleted),a.forEach(d=>{d.currentTarget=l,d._path=null}),a.sort((d,u)=>d.path.length-u.path.length),pn(l._dEH,a,e))})}),c.push(()=>i.emit("afterTransaction",[e,i])),oe(c,[]),e._needFormattingCleanup&&Vs(e)}finally{i.gc&&Ls(o,s,i.gcFilter),Cs(o,s),e.afterState.forEach((d,u)=>{const g=e.beforeState.get(u)||0;if(g!==d){const p=s.clients.get(u),w=F(P(p,g),1);for(let y=p.length-1;y>=w;)y-=1+mt(p,y)}});for(let d=r.length-1;d>=0;d--){const{client:u,clock:g}=r[d].id,p=s.clients.get(u),w=P(p,g);w+1<p.length&&mt(p,w+1)>1||w>0&&mt(p,w)}if(!e.local&&e.afterState.get(i.clientID)!==e.beforeState.get(i.clientID)&&(as(re,nn,"[yjs] ",sn,on,"Changed the client-id because another client seems to be using it."),i.clientID=fn()),i.emit("afterTransactionCleanup",[e,i]),i._observers.has("update")){const d=new ys;Ve(d,e)&&i.emit("update",[d.toUint8Array(),e.origin,i,e])}if(i._observers.has("updateV2")){const d=new ms;Ve(d,e)&&i.emit("updateV2",[d.toUint8Array(),e.origin,i,e])}const{subdocsAdded:c,subdocsLoaded:a,subdocsRemoved:l}=e;(c.size>0||l.size>0||a.size>0)&&(c.forEach(d=>{d.clientID=i.clientID,d.collectionid==null&&(d.collectionid=i.collectionid),i.subdocs.add(d)}),l.forEach(d=>i.subdocs.delete(d)),i.emit("subdocs",[{loaded:a,added:c,removed:l},i,e]),l.forEach(d=>d.destroy())),n.length<=t+1?(i._transactionCleanups=[],i.emit("afterAllTransactions",[i,n])):wn(n,t+1)}}},b=(n,t,e=null,i=!0)=>{const s=n._transactionCleanups;let o=!1,r=null;n._transaction===null&&(o=!0,n._transaction=new Ms(n,e,i),s.push(n._transaction),s.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{r=t(n._transaction)}finally{if(o){const c=n._transaction===s[0];n._transaction=null,c&&wn(s,0)}}return r},We="You must not compute changes after the event-handler fired.";class Mt{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=As(this.currentTarget,this.target))}deletes(t){return dn(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Y(We);const t=new Map,e=this.target;this.transaction.changed.get(e).forEach(s=>{if(s!==null){const o=e._map.get(s);let r,c;if(this.adds(o)){let a=o.left;for(;a!==null&&this.adds(a);)a=a.left;if(this.deletes(o))if(a!==null&&this.deletes(a))r="delete",c=Ut(a.content.getContent());else return;else a!==null&&this.deletes(a)?(r="update",c=Ut(a.content.getContent())):(r="add",c=void 0)}else if(this.deletes(o))r="delete",c=Ut(o.content.getContent());else return;t.set(s,{action:r,oldValue:c})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Y(We);const e=this.target,i=J(),s=J(),o=[];if(t={added:i,deleted:s,delta:o,keys:this.keys},this.transaction.changed.get(e).has(null)){let c=null;const a=()=>{c&&o.push(c)};for(let l=e._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((c===null||c.delete===void 0)&&(a(),c={delete:0}),c.delete+=l.length,s.add(l)):this.adds(l)?((c===null||c.insert===void 0)&&(a(),c={insert:[]}),c.insert=c.insert.concat(l.content.getContent()),i.add(l)):((c===null||c.retain===void 0)&&(a(),c={retain:0}),c.retain+=l.length);c!==null&&c.retain===void 0&&a()}this._changes=t}return t}}const As=(n,t)=>{const e=[];for(;t._item!==null&&t!==n;){if(t._item.parentSub!==null)e.unshift(t._item.parentSub);else{let i=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)!s.deleted&&s.countable&&(i+=s.length),s=s.right;e.unshift(i)}t=t._item.parent}return e},M=()=>{ls("Invalid access: Add Yjs type to a document before reading data.")},mn=80;let ae=0;class Ds{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=ae++}}const Ts=n=>{n.timestamp=ae++},bn=(n,t,e)=>{n.p.marker=!1,n.p=t,t.marker=!0,n.index=e,n.timestamp=ae++},Rs=(n,t,e)=>{if(n.length>=mn){const i=n.reduce((s,o)=>s.timestamp<o.timestamp?s:o);return bn(i,t,e),i}else{const i=new Ds(t,e);return n.push(i),i}},Lt=(n,t)=>{if(n._start===null||t===0||n._searchMarker===null)return null;const e=n._searchMarker.length===0?null:n._searchMarker.reduce((o,r)=>gt(t-o.index)<gt(t-r.index)?o:r);let i=n._start,s=0;for(e!==null&&(i=e.p,s=e.index,Ts(e));i.right!==null&&s<t;){if(!i.deleted&&i.countable){if(t<s+i.length)break;s+=i.length}i=i.right}for(;i.left!==null&&s>t;)i=i.left,!i.deleted&&i.countable&&(s-=i.length);for(;i.left!==null&&i.left.id.client===i.id.client&&i.left.id.clock+i.left.length===i.id.clock;)i=i.left,!i.deleted&&i.countable&&(s-=i.length);return e!==null&&gt(e.index-s)<i.parent.length/mn?(bn(e,i,s),e):Rs(n._searchMarker,i,s)},at=(n,t,e)=>{for(let i=n.length-1;i>=0;i--){const s=n[i];if(e>0){let o=s.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(s.index-=o.length);if(o===null||o.marker===!0){n.splice(i,1);continue}s.p=o,o.marker=!0}(t<s.index||e>0&&t===s.index)&&(s.index=F(t,s.index+e))}},Ct=(n,t,e)=>{const i=n,s=t.changedParentTypes;for(;Q(s,n,()=>[]).push(e),n._item!==null;)n=n._item.parent;pn(i._eH,e,t)};class I{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Oe(),this._dEH=Oe(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw T()}clone(){throw T()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Be(this._eH,t)}observeDeep(t){Be(this._dEH,t)}unobserve(t){qe(this._eH,t)}unobserveDeep(t){qe(this._dEH,t)}toJSON(){}}const kn=(n,t,e)=>{n.doc??M(),t<0&&(t=n._length+t),e<0&&(e=n._length+e);let i=e-t;const s=[];let o=n._start;for(;o!==null&&i>0;){if(o.countable&&!o.deleted){const r=o.content.getContent();if(r.length<=t)t-=r.length;else{for(let c=t;c<r.length&&i>0;c++)s.push(r[c]),i--;t=0}}o=o.right}return s},vn=n=>{n.doc??M();const t=[];let e=n._start;for(;e!==null;){if(e.countable&&!e.deleted){const i=e.content.getContent();for(let s=0;s<i.length;s++)t.push(i[s])}e=e.right}return t},lt=(n,t)=>{let e=0,i=n._start;for(n.doc??M();i!==null;){if(i.countable&&!i.deleted){const s=i.content.getContent();for(let o=0;o<s.length;o++)t(s[o],e++,n)}i=i.right}},Sn=(n,t)=>{const e=[];return lt(n,(i,s)=>{e.push(t(i,s,n))}),e},Us=n=>{let t=n._start,e=null,i=0;return{[Symbol.iterator](){return this},next:()=>{if(e===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};e=t.content.getContent(),i=0,t=t.right}const s=e[i++];return e.length<=i&&(e=null),{done:!1,value:s}}}},_n=(n,t)=>{n.doc??M();const e=Lt(n,t);let i=n._start;for(e!==null&&(i=e.p,t-=e.index);i!==null;i=i.right)if(!i.deleted&&i.countable){if(t<i.length)return i.content.getContent()[t];t-=i.length}},vt=(n,t,e,i)=>{let s=e;const o=n.doc,r=o.clientID,c=o.store,a=e===null?t._start:e.right;let l=[];const d=()=>{l.length>0&&(s=new j(k(r,L(c,r)),s,s&&s.lastId,a,a&&a.id,t,null,new X(l)),s.integrate(n,0),l=[])};i.forEach(u=>{if(u===null)l.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(u);break;default:switch(d(),u.constructor){case Uint8Array:case ArrayBuffer:s=new j(k(r,L(c,r)),s,s&&s.lastId,a,a&&a.id,t,null,new At(new Uint8Array(u))),s.integrate(n,0);break;case tt:s=new j(k(r,L(c,r)),s,s&&s.lastId,a,a&&a.id,t,null,new Dt(u)),s.integrate(n,0);break;default:if(u instanceof I)s=new j(k(r,L(c,r)),s,s&&s.lastId,a,a&&a.id,t,null,new V(u)),s.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},En=()=>Y("Length exceeded!"),In=(n,t,e,i)=>{if(e>t._length)throw En();if(e===0)return t._searchMarker&&at(t._searchMarker,e,i.length),vt(n,t,null,i);const s=e,o=Lt(t,e);let r=t._start;for(o!==null&&(r=o.p,e-=o.index,e===0&&(r=r.prev,e+=r&&r.countable&&!r.deleted?r.length:0));r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<=r.length){e<r.length&&N(n,k(r.id.client,r.id.clock+e));break}e-=r.length}return t._searchMarker&&at(t._searchMarker,s,i.length),vt(n,t,r,i)},Ps=(n,t,e)=>{let s=(t._searchMarker||[]).reduce((o,r)=>r.index>o.index?r:o,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return vt(n,t,s,e)},jn=(n,t,e,i)=>{if(i===0)return;const s=e,o=i,r=Lt(t,e);let c=t._start;for(r!==null&&(c=r.p,e-=r.index);c!==null&&e>0;c=c.right)!c.deleted&&c.countable&&(e<c.length&&N(n,k(c.id.client,c.id.clock+e)),e-=c.length);for(;i>0&&c!==null;)c.deleted||(i<c.length&&N(n,k(c.id.client,c.id.clock+i)),c.delete(n),i-=c.length),c=c.right;if(i>0)throw En();t._searchMarker&&at(t._searchMarker,s,-o+i)},St=(n,t,e)=>{const i=t._map.get(e);i!==void 0&&i.delete(n)},le=(n,t,e,i)=>{const s=t._map.get(e)||null,o=n.doc,r=o.clientID;let c;if(i==null)c=new X([i]);else switch(i.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:c=new X([i]);break;case Uint8Array:c=new At(i);break;case tt:c=new Dt(i);break;default:if(i instanceof I)c=new V(i);else throw new Error("Unexpected content type")}new j(k(r,L(o.store,r)),s,s&&s.lastId,null,null,t,e,c).integrate(n,0)},de=(n,t)=>{n.doc??M();const e=n._map.get(t);return e!==void 0&&!e.deleted?e.content.getContent()[e.length-1]:void 0},Mn=n=>{const t={};return n.doc??M(),n._map.forEach((e,i)=>{e.deleted||(t[i]=e.content.getContent()[e.length-1])}),t},Ln=(n,t)=>{n.doc??M();const e=n._map.get(t);return e!==void 0&&!e.deleted},xs=(n,t)=>{const e={};return n._map.forEach((i,s)=>{let o=i;for(;o!==null&&(!t.sv.has(o.id.client)||o.id.clock>=(t.sv.get(o.id.client)||0));)o=o.left;o!==null&&H(o,t)&&(e[s]=o.content.getContent()[o.length-1])}),e},ft=n=>(n.doc??M(),ds(n._map.entries(),t=>!t[1].deleted));class Os extends Mt{}class st extends I{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new st;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new st}clone(){const t=new st;return t.insert(0,this.toArray().map(e=>e instanceof I?e.clone():e)),t}get length(){return this.doc??M(),this._length}_callObserver(t,e){super._callObserver(t,e),Ct(this,t,new Os(this,t))}insert(t,e){this.doc!==null?b(this.doc,i=>{In(i,this,t,e)}):this._prelimContent.splice(t,0,...e)}push(t){this.doc!==null?b(this.doc,e=>{Ps(e,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){this.doc!==null?b(this.doc,i=>{jn(i,this,t,e)}):this._prelimContent.splice(t,e)}get(t){return _n(this,t)}toArray(){return vn(this)}slice(t=0,e=this.length){return kn(this,t,e)}toJSON(){return this.map(t=>t instanceof I?t.toJSON():t)}map(t){return Sn(this,t)}forEach(t){lt(this,t)}[Symbol.iterator](){return Us(this)}_write(t){t.writeTypeRef(Js)}}class Bs extends Mt{constructor(t,e,i){super(t,e),this.keysChanged=i}}class _t extends I{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach((i,s)=>{this.set(s,i)}),this._prelimContent=null}_copy(){return new _t}clone(){const t=new _t;return this.forEach((e,i)=>{t.set(i,e instanceof I?e.clone():e)}),t}_callObserver(t,e){Ct(this,t,new Bs(this,t,e))}toJSON(){this.doc??M();const t={};return this._map.forEach((e,i)=>{if(!e.deleted){const s=e.content.getContent()[e.length-1];t[i]=s instanceof I?s.toJSON():s}}),t}get size(){return[...ft(this)].length}keys(){return qt(ft(this),t=>t[0])}values(){return qt(ft(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return qt(ft(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??M(),this._map.forEach((e,i)=>{e.deleted||t(e.content.getContent()[e.length-1],i,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?b(this.doc,e=>{St(e,this,t)}):this._prelimContent.delete(t)}set(t,e){return this.doc!==null?b(this.doc,i=>{le(i,this,t,e)}):this._prelimContent.set(t,e),e}get(t){return de(this,t)}has(t){return Ln(this,t)}clear(){this.doc!==null?b(this.doc,t=>{this.forEach(function(e,i,s){St(t,s,i)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Ks)}}const q=(n,t)=>n===t||typeof n=="object"&&typeof t=="object"&&n&&t&&$i(n,t);class te{constructor(t,e,i,s){this.left=t,this.right=e,this.index=i,this.currentAttributes=s}forward(){switch(this.right===null&&G(),this.right.content.constructor){case S:this.right.deleted||et(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Ge=(n,t,e)=>{for(;t.right!==null&&e>0;){switch(t.right.content.constructor){case S:t.right.deleted||et(t.currentAttributes,t.right.content);break;default:t.right.deleted||(e<t.right.length&&N(n,k(t.right.id.client,t.right.id.clock+e)),t.index+=t.right.length,e-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},pt=(n,t,e,i)=>{const s=new Map,o=i?Lt(t,e):null;if(o){const r=new te(o.p.left,o.p,o.index,s);return Ge(n,r,e-o.index)}else{const r=new te(null,t._start,0,s);return Ge(n,r,e)}},Cn=(n,t,e,i)=>{for(;e.right!==null&&(e.right.deleted===!0||e.right.content.constructor===S&&q(i.get(e.right.content.key),e.right.content.value));)e.right.deleted||i.delete(e.right.content.key),e.forward();const s=n.doc,o=s.clientID;i.forEach((r,c)=>{const a=e.left,l=e.right,d=new j(k(o,L(s.store,o)),a,a&&a.lastId,l,l&&l.id,t,null,new S(c,r));d.integrate(n,0),e.right=d,e.forward()})},et=(n,t)=>{const{key:e,value:i}=t;i===null?n.delete(e):n.set(e,i)},An=(n,t)=>{for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===S&&q(t[n.right.content.key]??null,n.right.content.value)))break;n.forward()}},Dn=(n,t,e,i)=>{const s=n.doc,o=s.clientID,r=new Map;for(const c in i){const a=i[c],l=e.currentAttributes.get(c)??null;if(!q(l,a)){r.set(c,l);const{left:d,right:u}=e;e.right=new j(k(o,L(s.store,o)),d,d&&d.lastId,u,u&&u.id,t,null,new S(c,a)),e.right.integrate(n,0),e.forward()}}return r},Vt=(n,t,e,i,s)=>{e.currentAttributes.forEach((g,p)=>{s[p]===void 0&&(s[p]=null)});const o=n.doc,r=o.clientID;An(e,s);const c=Dn(n,t,e,s),a=i.constructor===String?new x(i):i instanceof I?new V(i):new nt(i);let{left:l,right:d,index:u}=e;t._searchMarker&&at(t._searchMarker,e.index,a.getLength()),d=new j(k(r,L(o.store,r)),l,l&&l.lastId,d,d&&d.id,t,null,a),d.integrate(n,0),e.right=d,e.index=u,e.forward(),Cn(n,t,e,c)},He=(n,t,e,i,s)=>{const o=n.doc,r=o.clientID;An(e,s);const c=Dn(n,t,e,s);t:for(;e.right!==null&&(i>0||c.size>0&&(e.right.deleted||e.right.content.constructor===S));){if(!e.right.deleted)switch(e.right.content.constructor){case S:{const{key:a,value:l}=e.right.content,d=s[a];if(d!==void 0){if(q(d,l))c.delete(a);else{if(i===0)break t;c.set(a,l)}e.right.delete(n)}else e.currentAttributes.set(a,l);break}default:i<e.right.length&&N(n,k(e.right.id.client,e.right.id.clock+i)),i-=e.right.length;break}e.forward()}if(i>0){let a="";for(;i>0;i--)a+=`
`;e.right=new j(k(r,L(o.store,r)),e.left,e.left&&e.left.lastId,e.right,e.right&&e.right.id,t,null,new x(a)),e.right.integrate(n,0),e.forward()}Cn(n,t,e,c)},Tn=(n,t,e,i,s)=>{let o=t;const r=D();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===S){const l=o.content;r.set(l.key,l)}o=o.right}let c=0,a=!1;for(;t!==o;){if(e===t&&(a=!0),!t.deleted){const l=t.content;switch(l.constructor){case S:{const{key:d,value:u}=l,g=i.get(d)??null;(r.get(d)!==l||g===u)&&(t.delete(n),c++,!a&&(s.get(d)??null)===u&&g!==u&&(g===null?s.delete(d):s.set(d,g))),!a&&!t.deleted&&et(s,l);break}}}t=t.right}return c},qs=(n,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const e=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===S){const i=t.content.key;e.has(i)?t.delete(n):e.add(i)}t=t.left}},Ns=n=>{let t=0;return b(n.doc,e=>{let i=n._start,s=n._start,o=D();const r=Kt(o);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case S:et(r,s.content);break;default:t+=Tn(e,i,s,o,r),o=Kt(r),i=s;break}s=s.right}}),t},Vs=n=>{const t=new Set,e=n.doc;for(const[i,s]of n.afterState.entries()){const o=n.beforeState.get(i)||0;s!==o&&yn(n,e.store.clients.get(i),o,s,r=>{!r.deleted&&r.content.constructor===S&&r.constructor!==B&&t.add(r.parent)})}b(e,i=>{ln(n,n.deleteSet,s=>{if(s instanceof B||!s.parent._hasFormatting||t.has(s.parent))return;const o=s.parent;s.content.constructor===S?t.add(o):qs(i,s)});for(const s of t)Ns(s)})},$e=(n,t,e)=>{const i=e,s=Kt(t.currentAttributes),o=t.right;for(;e>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case V:case nt:case x:e<t.right.length&&N(n,k(t.right.id.client,t.right.id.clock+e)),e-=t.right.length,t.right.delete(n);break}t.forward()}o&&Tn(n,o,t.right,s,t.currentAttributes);const r=(t.left||t.right).parent;return r._searchMarker&&at(r._searchMarker,t.index,-i+e),t};class zs extends Mt{constructor(t,e,i){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,i.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,e=[];b(t,i=>{const s=new Map,o=new Map;let r=this.target._start,c=null;const a={};let l="",d=0,u=0;const g=()=>{if(c!==null){let p=null;switch(c){case"delete":u>0&&(p={delete:u}),u=0;break;case"insert":(typeof l=="object"||l.length>0)&&(p={insert:l},s.size>0&&(p.attributes={},s.forEach((w,y)=>{w!==null&&(p.attributes[y]=w)}))),l="";break;case"retain":d>0&&(p={retain:d},Wi(a)||(p.attributes=Ni({},a))),d=0;break}p&&e.push(p),c=null}};for(;r!==null;){switch(r.content.constructor){case V:case nt:this.adds(r)?this.deletes(r)||(g(),c="insert",l=r.content.getContent()[0],g()):this.deletes(r)?(c!=="delete"&&(g(),c="delete"),u+=1):r.deleted||(c!=="retain"&&(g(),c="retain"),d+=1);break;case x:this.adds(r)?this.deletes(r)||(c!=="insert"&&(g(),c="insert"),l+=r.content.str):this.deletes(r)?(c!=="delete"&&(g(),c="delete"),u+=r.length):r.deleted||(c!=="retain"&&(g(),c="retain"),d+=r.length);break;case S:{const{key:p,value:w}=r.content;if(this.adds(r)){if(!this.deletes(r)){const y=s.get(p)??null;q(y,w)?w!==null&&r.delete(i):(c==="retain"&&g(),q(w,o.get(p)??null)?delete a[p]:a[p]=w)}}else if(this.deletes(r)){o.set(p,w);const y=s.get(p)??null;q(y,w)||(c==="retain"&&g(),a[p]=y)}else if(!r.deleted){o.set(p,w);const y=a[p];y!==void 0&&(q(y,w)?y!==null&&r.delete(i):(c==="retain"&&g(),w===null?delete a[p]:a[p]=w))}r.deleted||(c==="insert"&&g(),et(s,r.content));break}}r=r.right}for(g();e.length>0;){const p=e[e.length-1];if(p.retain!==void 0&&p.attributes===void 0)e.pop();else break}}),this._delta=e}return this._delta}}class Et extends I{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??M(),this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach(i=>i())}catch(i){console.error(i)}this._pending=null}_copy(){return new Et}clone(){const t=new Et;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const i=new zs(this,t,e);Ct(this,t,i),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??M();let t="",e=this._start;for(;e!==null;)!e.deleted&&e.countable&&e.content.constructor===x&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){this.doc!==null?b(this.doc,i=>{const s=new te(null,this._start,0,new Map);for(let o=0;o<t.length;o++){const r=t[o];if(r.insert!==void 0){const c=!e&&typeof r.insert=="string"&&o===t.length-1&&s.right===null&&r.insert.slice(-1)===`
`?r.insert.slice(0,-1):r.insert;(typeof c!="string"||c.length>0)&&Vt(i,this,s,c,r.attributes||{})}else r.retain!==void 0?He(i,this,s,r.retain,r.attributes||{}):r.delete!==void 0&&$e(i,s,r.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,e,i){this.doc??M();const s=[],o=new Map,r=this.doc;let c="",a=this._start;function l(){if(c.length>0){const u={};let g=!1;o.forEach((w,y)=>{g=!0,u[y]=w});const p={insert:c};g&&(p.attributes=u),s.push(p),c=""}}const d=()=>{for(;a!==null;){if(H(a,t)||e!==void 0&&H(a,e))switch(a.content.constructor){case x:{const u=o.get("ychange");t!==void 0&&!H(a,t)?(u===void 0||u.user!==a.id.client||u.type!=="removed")&&(l(),o.set("ychange",i?i("removed",a.id):{type:"removed"})):e!==void 0&&!H(a,e)?(u===void 0||u.user!==a.id.client||u.type!=="added")&&(l(),o.set("ychange",i?i("added",a.id):{type:"added"})):u!==void 0&&(l(),o.delete("ychange")),c+=a.content.str;break}case V:case nt:{l();const u={insert:a.content.getContent()[0]};if(o.size>0){const g={};u.attributes=g,o.forEach((p,w)=>{g[w]=p})}s.push(u);break}case S:H(a,t)&&(l(),et(o,a.content));break}a=a.right}l()};return t||e?b(r,u=>{t&&Qt(u,t),e&&Qt(u,e),d()},"cleanup"):d(),s}insert(t,e,i){if(e.length<=0)return;const s=this.doc;s!==null?b(s,o=>{const r=pt(o,this,t,!i);i||(i={},r.currentAttributes.forEach((c,a)=>{i[a]=c})),Vt(o,this,r,e,i)}):this._pending.push(()=>this.insert(t,e,i))}insertEmbed(t,e,i){const s=this.doc;s!==null?b(s,o=>{const r=pt(o,this,t,!i);Vt(o,this,r,e,i||{})}):this._pending.push(()=>this.insertEmbed(t,e,i||{}))}delete(t,e){if(e===0)return;const i=this.doc;i!==null?b(i,s=>{$e(s,pt(s,this,t,!0),e)}):this._pending.push(()=>this.delete(t,e))}format(t,e,i){if(e===0)return;const s=this.doc;s!==null?b(s,o=>{const r=pt(o,this,t,!1);r.right!==null&&He(o,this,r,e,i)}):this._pending.push(()=>this.format(t,e,i))}removeAttribute(t){this.doc!==null?b(this.doc,e=>{St(e,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,e){this.doc!==null?b(this.doc,i=>{le(i,this,t,e)}):this._pending.push(()=>this.setAttribute(t,e))}getAttribute(t){return de(this,t)}getAttributes(){return Mn(this)}_write(t){t.writeTypeRef(Ys)}}class zt{constructor(t,e=()=>!0){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??M()}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(e)))do if(e=t.content.type,!t.deleted&&(e.constructor===dt||e.constructor===Z)&&e._start!==null)t=e._start;else for(;t!==null;){const i=t.next;if(i!==null){t=i;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Z extends I{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Z}clone(){const t=new Z;return t.insert(0,this.toArray().map(e=>e instanceof I?e.clone():e)),t}get length(){return this.doc??M(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new zt(this,t)}querySelector(t){t=t.toUpperCase();const i=new zt(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return i.done?null:i.value}querySelectorAll(t){return t=t.toUpperCase(),K(new zt(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t))}_callObserver(t,e){Ct(this,t,new Ws(this,e,t))}toString(){return Sn(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},i){const s=t.createDocumentFragment();return i!==void 0&&i._createAssociation(s,this),lt(this,o=>{s.insertBefore(o.toDOM(t,e,i),null)}),s}insert(t,e){this.doc!==null?b(this.doc,i=>{In(i,this,t,e)}):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(this.doc!==null)b(this.doc,i=>{const s=t&&t instanceof I?t._item:t;vt(i,this,s,e)});else{const i=this._prelimContent,s=t===null?0:i.findIndex(o=>o===t)+1;if(s===0&&t!==null)throw Y("Reference item not found");i.splice(s,0,...e)}}delete(t,e=1){this.doc!==null?b(this.doc,i=>{jn(i,this,t,e)}):this._prelimContent.splice(t,e)}toArray(){return vn(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return _n(this,t)}slice(t=0,e=this.length){return kn(this,t,e)}forEach(t){lt(this,t)}_write(t){t.writeTypeRef(Xs)}}class dt extends Z{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach((i,s)=>{this.setAttribute(s,i)}),this._prelimAttrs=null}_copy(){return new dt(this.nodeName)}clone(){const t=new dt(this.nodeName),e=this.getAttributes();return zi(e,(i,s)=>{typeof i=="string"&&t.setAttribute(s,i)}),t.insert(0,this.toArray().map(i=>i instanceof I?i.clone():i)),t}toString(){const t=this.getAttributes(),e=[],i=[];for(const c in t)i.push(c);i.sort();const s=i.length;for(let c=0;c<s;c++){const a=i[c];e.push(a+'="'+t[a]+'"')}const o=this.nodeName.toLocaleLowerCase(),r=e.length>0?" "+e.join(" "):"";return`<${o}${r}>${super.toString()}</${o}>`}removeAttribute(t){this.doc!==null?b(this.doc,e=>{St(e,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,e){this.doc!==null?b(this.doc,i=>{le(i,this,t,e)}):this._prelimAttrs.set(t,e)}getAttribute(t){return de(this,t)}hasAttribute(t){return Ln(this,t)}getAttributes(t){return t?xs(this,t):Mn(this)}toDOM(t=document,e={},i){const s=t.createElement(this.nodeName),o=this.getAttributes();for(const r in o){const c=o[r];typeof c=="string"&&s.setAttribute(r,c)}return lt(this,r=>{s.appendChild(r.toDOM(t,e,i))}),i!==void 0&&i._createAssociation(s,this),s}_write(t){t.writeTypeRef(Zs),t.writeKey(this.nodeName)}}class Ws extends Mt{constructor(t,e,i){super(t,i),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class Rn{constructor(t,e){this.id=t,this.length=e}get deleted(){throw T()}mergeWith(t){return!1}write(t,e,i){throw T()}integrate(t,e){throw T()}}const Gs=0;class B extends Rn{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),gn(t.doc.store,this)}write(t,e){t.writeInfo(Gs),t.writeLen(this.length-e)}getMissing(t,e){return null}}class At{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new At(this.content)}splice(t){throw T()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}class It{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new It(this.len)}splice(t){const e=new It(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){un(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const Hs=(n,t)=>new tt({guid:n,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Dt{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),t.meta!==null&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Dt(Hs(this.doc.guid,this.opts))}splice(t){throw T()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}class nt{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new nt(this.embed)}splice(t){throw T()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}class S{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new S(this.key,this.value)}splice(t){throw T()}mergeWith(t){return!1}integrate(t,e){const i=e.parent;i._searchMarker=null,i._hasFormatting=!0}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const $s=kt("node_env")==="development";class X{constructor(t){this.arr=t,$s&&Fe(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new X(this.arr)}splice(t){const e=new X(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const i=this.arr.length;t.writeLen(i-e);for(let s=e;s<i;s++){const o=this.arr[s];t.writeAny(o)}}getRef(){return 8}}class x{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new x(this.str)}splice(t){const e=new x(this.str.slice(t));this.str=this.str.slice(0,t);const i=this.str.charCodeAt(t-1);return i>=55296&&i<=56319&&(this.str=this.str.slice(0,t-1)+"�",e.str="�"+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(e===0?this.str:this.str.slice(e))}getRef(){return 4}}const Js=0,Ks=1,Ys=2,Zs=3,Xs=4;class V{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new V(this.type._copy())}splice(t){throw T()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;e!==null;)e.deleted?e.id.clock<(t.beforeState.get(e.id.client)||0)&&t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach(i=>{i.deleted?i.id.clock<(t.beforeState.get(i.id.client)||0)&&t._mergeStructs.push(i):i.delete(t)}),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;e!==null;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach(i=>{for(;i!==null;)i.gc(t,!0),i=i.left}),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const Un=(n,t,e)=>{const{client:i,clock:s}=t.id,o=new j(k(i,s+e),t,k(i,s+e-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e));return t.deleted&&o.markDeleted(),t.keep&&(o.keep=!0),t.redone!==null&&(o.redone=k(t.redone.client,t.redone.clock+e)),t.right=o,o.right!==null&&(o.right.left=o),n._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),t.length=e,o};class j extends Rn{constructor(t,e,i,s,o,r,c,a){super(t,a.getLength()),this.origin=i,this.left=e,this.right=s,this.rightOrigin=o,this.parent=r,this.parentSub=c,this.redone=null,this.content=a,this.info=this.content.isCountable()?Me:0}set marker(t){(this.info&xt)>0!==t&&(this.info^=xt)}get marker(){return(this.info&xt)>0}get keep(){return(this.info&je)>0}set keep(t){this.keep!==t&&(this.info^=je)}get countable(){return(this.info&Me)>0}get deleted(){return(this.info&Pt)>0}set deleted(t){this.deleted!==t&&(this.info^=Pt)}markDeleted(){this.info|=Pt}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=L(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=L(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===wt&&this.id.client!==this.parent.client&&this.parent.clock>=L(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Ne(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=N(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===B||this.right&&this.right.constructor===B)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===j?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===j&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===wt){const i=Nt(e,this.parent);i.constructor===B?this.parent=null:this.parent=i.content.type}return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=Ne(t,t.doc.store,k(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let i=this.left,s;if(i!==null)s=i.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const o=new Set,r=new Set;for(;s!==null&&s!==this.right;){if(r.add(s),o.add(s),ut(this.origin,s.origin)){if(s.id.client<this.id.client)i=s,o.clear();else if(ut(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&r.has(Nt(t.doc.store,s.origin)))o.has(Nt(t.doc.store,s.origin))||(i=s,o.clear());else break;s=s.right}this.left=i}if(this.left!==null){const i=this.left.right;this.right=i,this.left.right=this}else{let i;if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start,this.parent._start=this;this.right=i}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),gn(t.doc.store,this),this.content.integrate(t,this),ze(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new B(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:k(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&ut(t.origin,this.lastId)&&this.right===t&&ut(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach(i=>{i.p===t&&(i.p=this,!this.deleted&&this.countable&&(i.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&this.parentSub===null&&(e._length-=this.length),this.markDeleted(),un(t.deleteSet,this.id.client,this.id.clock,this.length),ze(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw G();this.content.gc(t),e?js(t,this,new B(this.id,this.length)):this.content=new It(this.length)}write(t,e){const i=e>0?k(this.id.client,this.id.clock+e-1):this.origin,s=this.rightOrigin,o=this.parentSub,r=this.content.getRef()&pi|(i===null?0:bt)|(s===null?0:Ze)|(o===null?0:fi);if(t.writeInfo(r),i!==null&&t.writeLeftID(i),s!==null&&t.writeRightID(s),i===null&&s===null){const c=this.parent;if(c._item!==void 0){const a=c._item;if(a===null){const l=_s(c);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(a.id)}else c.constructor===String?(t.writeParentInfo(!0),t.writeString(c)):c.constructor===wt?(t.writeParentInfo(!1),t.writeLeftID(c)):G();o!==null&&t.writeString(o)}this.content.write(t,e)}}const Pn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},xn="__ $YJS$ __";Pn[xn]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Pn[xn]=!0;class Qs{constructor(t,e){_(this,"yDoc");_(this,"yText");_(this,"currentProjectId",null);this.appwrite=t,this.storage=e,this.yDoc=new tt,this.yText=this.yDoc.getText("content")}async render(t,e){var i,s;this.currentProjectId=e,t.innerHTML=`
      <div class="editor-header">
        <button id="back-btn">← Back to Projects</button>
        <span id="project-name"></span>
        <div class="editor-actions">
          <button id="save-btn">Save</button>
          <button id="run-btn">Run</button>
          <span id="collab-status">👤 Solo</span>
        </div>
      </div>
      <div class="editor-workspace">
        <div class="file-tree">
          <h3>Files</h3>
          <div id="file-list"></div>
          <button id="new-file-btn">+ New File</button>
        </div>
        <div class="code-editor">
          <textarea id="code-input" spellcheck="false"></textarea>
        </div>
        <div class="output-panel">
          <h3>Output</h3>
          <pre id="output-content"></pre>
        </div>
      </div>
    `,await this.loadProject(e),this.setupCollaboration(e),(i=document.getElementById("save-btn"))==null||i.addEventListener("click",()=>this.saveProject()),(s=document.getElementById("run-btn"))==null||s.addEventListener("click",()=>this.runCode())}async loadProject(t){let e;try{navigator.onLine?e=(await this.appwrite.getProjects()).find(s=>s.id===t):e=await this.storage.getProject(t)}catch{e=await this.storage.getProject(t)}if(!e){alert("Project not found");return}document.getElementById("project-name").textContent=e.name;const i=Object.keys(e.files)[0];if(i){const s=document.getElementById("code-input");s.value=e.files[i]}}setupCollaboration(t){this.appwrite.subscribeToProject(t,i=>{console.log("Real-time update:",i),this.applyRemoteChanges(i.payload)});const e=document.getElementById("code-input");e.addEventListener("input",()=>{this.yText.delete(0,this.yText.length),this.yText.insert(0,e.value)}),this.yText.observe(()=>{e.value=this.yText.toString()})}applyRemoteChanges(t){console.log("Applying remote changes:",t)}async saveProject(){if(!this.currentProjectId)return;const e=document.getElementById("code-input").value;try{navigator.onLine?await this.appwrite.updateProject(this.currentProjectId,{files:{"main.js":e}}):(await this.storage.saveProject({id:this.currentProjectId,files:{"main.js":e},updatedAt:new Date().toISOString()}),await this.storage.addPendingSync("update",this.currentProjectId,{files:{"main.js":e}})),alert("Saved!")}catch(i){console.error("Save failed:",i),alert("Save failed")}}async runCode(){const e=document.getElementById("code-input").value;try{const s=await(await fetch("/api/sandbox/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})})).json(),o=document.getElementById("output-content");o.textContent=s.output||s.error||"No output"}catch(i){console.error("Execution failed:",i);const s=document.getElementById("output-content");s.textContent=`Error: ${i}`}}}class Fs{async render(t){t.innerHTML=`
      <div class="analytics-dashboard">
        <h2>Analytics Dashboard</h2>
        <div class="analytics-grid">
          <div class="analytics-chart">
            <h3>Daily Active Users</h3>
            <canvas id="users-chart"></canvas>
          </div>
          <div class="analytics-chart">
            <h3>Project Builds</h3>
            <canvas id="builds-chart"></canvas>
          </div>
          <div class="analytics-chart">
            <h3>Edge Execution Times</h3>
            <canvas id="execution-chart"></canvas>
          </div>
        </div>
      </div>
    `,await this.loadAnalytics()}async loadAnalytics(){try{const e=await(await fetch("/api/analytics")).json();console.log("Analytics data:",e)}catch(t){console.error("Failed to load analytics:",t)}}}class to{constructor(){_(this,"appwrite");_(this,"storage");_(this,"sync");_(this,"projectList");_(this,"codeEditor");_(this,"analyticsDashboard");this.appwrite=new $n,this.storage=new oi,this.sync=new ri(this.appwrite,this.storage),this.projectList=new ci(this.appwrite,this.storage),this.codeEditor=new Qs(this.appwrite,this.storage),this.analyticsDashboard=new Fs,this.init()}async init(){if("serviceWorker"in navigator)try{await navigator.serviceWorker.register("/sw.js"),console.log("Service Worker registered")}catch(t){console.error("Service Worker registration failed:",t)}window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),this.setupNavigation(),this.showAnalytics(),this.sync.start()}setupNavigation(){var t,e,i;(t=document.getElementById("projects-btn"))==null||t.addEventListener("click",()=>{this.showProjects()}),(e=document.getElementById("analytics-btn"))==null||e.addEventListener("click",()=>{this.showAnalytics()}),(i=document.getElementById("login-btn"))==null||i.addEventListener("click",()=>{this.showLogin()})}showProjects(){document.getElementById("project-list").style.display="block",document.getElementById("code-editor").style.display="none",document.getElementById("analytics-dashboard").style.display="none",this.projectList.render(document.getElementById("project-list"))}showAnalytics(){document.getElementById("project-list").style.display="none",document.getElementById("code-editor").style.display="none",document.getElementById("analytics-dashboard").style.display="block",this.analyticsDashboard.render(document.getElementById("analytics-dashboard"))}showLogin(){console.log("Show login")}handleOnline(){document.getElementById("offline-indicator").style.display="none",this.sync.syncPendingChanges()}handleOffline(){document.getElementById("offline-indicator").style.display="block"}}new to;
